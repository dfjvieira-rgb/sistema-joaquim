<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>RADAR ELITE - SCANNER</title>
    <style>
        :root { --gold: #fbbf24; --bg: #000; }
        body { 
            background: var(--bg); color: white; font-family: 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden; border: 4px solid var(--gold);
        }
        #radar-circle {
            width: 150px; height: 150px; border: 2px solid var(--gold);
            border-radius: 50%; position: relative; display: flex;
            align-items: center; justify-content: center; text-align: center;
            transition: 0.5s;
        }
        .sweep {
            position: absolute; width: 50%; height: 2px; 
            background: linear-gradient(to right, transparent, var(--gold));
            top: 50%; left: 50%; transform-origin: left;
            animation: rotate 2s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        #info-box { margin-top: 15px; text-align: center; width: 90%; }
        #status-label { font-size: 0.6rem; letter-spacing: 2px; color: var(--gold); }
        #peca-detectada { font-size: 0.9rem; font-weight: 900; margin-top: 5px; text-transform: uppercase; }
        
        .radar-blink { animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="radar-circle">
        <div class="sweep" id="ponteiro"></div>
        <div id="peca-detectada">BUSCANDO...</div>
    </div>
    <div id="info-box">
        <div id="status-label">SCANNER ATIVO</div>
    </div>

    <script type="module">
        import { BANCO_ESPELHOS } from './banco-espelhos.js';

        // A INTELIGÊNCIA QUE VOCÊ QUERIA:
        const DICIONARIO = [
            { id: "AGRAVO DE PETIÇÃO", display: "AGRAVO DE PETIÇÃO", cor: "#f87171" },
            { id: "RECURSO ORDINÁRIO", display: "RECURSO ORDINÁRIO", cor: "#3b82f6" },
            { id: "CONTESTAÇÃO", display: "CONTESTAÇÃO TRABALHISTA", cor: "#22c55e" },
            { id: "RECLAMAÇÃO", display: "RECLAMATÓRIA TRABALHISTA", cor: "#a855f7" }
        ];

        const realizarEscaneamento = () => {
            const activeEx = localStorage.getItem('activeEx') || "44";
            const textoBanco = (BANCO_ESPELHOS[activeEx] || "").toUpperCase();
            
            const pDetectada = document.getElementById('peca-detectada');
            const circle = document.getElementById('radar-circle');
            const ponteiro = document.getElementById('ponteiro');

            // Busca no dicionário conforme a lógica do seu código original
            let encontrado = DICIONARIO.find(p => textoBanco.includes(p.id));

            if (encontrado) {
                // Alvo Identificado
                pDetectada.innerText = encontrado.id;
                pDetectada.style.color = encontrado.cor;
                circle.style.borderColor = encontrado.cor;
                circle.style.boxShadow = `0 0 20px ${encontrado.cor}`;
                ponteiro.style.background = `linear-gradient(to right, transparent, ${encontrado.cor})`;
                
                // Envia para a Home
                localStorage.setItem('radar_peca_id', encontrado.display);
            } else {
                // Modo de Busca
                pDetectada.innerText = "VARRENDO...";
                pDetectada.style.color = "var(--gold)";
                circle.style.borderColor = "var(--gold)";
                circle.style.boxShadow = "none";
                ponteiro.style.background = `linear-gradient(to right, transparent, var(--gold))`;
                
                localStorage.setItem('radar_peca_id', "CADERNO DE RESPOSTAS");
            }
        };

        // Monitora se você trocar o exame na Home
        window.addEventListener('storage', (e) => {
            if (e.key === 'activeEx') realizarEscaneamento();
        });

        // Inicia o radar
        window.onload = realizarEscaneamento;
        // Atualiza a cada 2 segundos para garantir sincronia
        setInterval(realizarEscaneamento, 2000);
    </script>
</body>
</html>
