<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>JOAQUIM ELITE 2026 - HOME</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-paper: #cbd5e1; --paper-color: #ffffff; --line-color: #d1d5db;
            --text-color: #1e293b; --margem-cor: #f87171; --gold: #fbbf24;
            --primary: #0f172a; --sidebar-w: 80px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg-paper); font-family: 'Inter', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: var(--sidebar-w); background: var(--primary); display: flex; flex-direction: column; gap: 10px; padding: 15px; border-right: 2px solid var(--gold); }
        .btn-side { width: 100%; height: 50px; border-radius: 10px; border: none; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.2s; }
        .btn-side:hover { transform: scale(1.05); }

        /* ÁREA DA FOLHA */
        .main-content { flex: 1; overflow-y: auto; display: flex; justify-content: center; padding: 40px 20px; position: relative; }
        
        .paper { 
            background: var(--paper-color); width: 100%; max-width: 850px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; position: relative;
            min-height: fit-content;
        }

        .regua { width: 50px; border-right: 1px solid var(--line-color); background: #f8fafc; flex-shrink: 0; padding-top: 50px; }
        .regua-num { height: 35px; font-size: 0.7rem; color: #64748b; display: flex; align-items: center; justify-content: center; }

        .conteudo-total { flex: 1; position: relative; }
        .margem-oab { position: absolute; top: 0; right: 55px; width: 1.5px; height: 100%; background: var(--margem-cor); opacity: 0.4; pointer-events: none; }

        #identificador { padding: 15px; text-align: center; font-weight: 900; background: #fff; border-bottom: 2px solid var(--line-color); color: var(--primary); text-transform: uppercase; }

        .grid-oab { width: 100%; border-collapse: collapse; table-layout: fixed; }
        .grid-oab td { 
            height: 35px; padding: 0 70px 0 15px; border-bottom: 1px solid var(--line-color);
            font-family: 'Courier New', monospace; font-size: 18px; color: var(--text-color); outline: none;
        }

        /* DIVISÓRIAS */
        .separador { contenteditable: false; user-select: none; }
        .header-separador { background: var(--primary); color: var(--gold); padding: 8px !important; text-align: center; font-size: 0.75rem !important; font-weight: bold; }
        .item-separador { background: #f1f5f9; color: #64748b; padding: 4px 15px !important; font-size: 0.65rem !important; font-weight: bold; }

        #radar-box { background: #000; border: 1px solid var(--gold); padding: 5px; border-radius: 5px; text-align: center; font-size: 0.6rem; color: #fff; margin-bottom: 10px; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div id="radar-box">RADAR<br><span id="radar-status" style="color:var(--gold)">ON</span></div>
        <button class="btn-side" style="background:var(--gold); color:black;" onclick="abrirModalExames()"><i class="fas fa-bullseye"></i></button>
        <button class="btn-side" style="background:#3b82f6;" onclick="injetarJustica()"><i class="fas fa-gavel"></i></button>
        <button class="btn-side" style="background:#0ea5e9;" onclick="salvarManual()"><i class="fas fa-save"></i></button>
        <button class="btn-side" style="background:#475569;" onclick="irPara(1)"><b>P</b></button>
        <button class="btn-side" style="background:#475569;" onclick="irPara(51)"><b>Q</b></button>
    </aside>

    <main class="main-content">
        <div class="paper">
            <div class="regua" id="regua-oab"></div>
            <div class="conteudo-total">
                <div class="margem-oab"></div>
                <div id="identificador">CADERNO DE RESPOSTAS</div>
                <table class="grid-oab">
                    <tbody id="CORPO_FOLHA_ELITE" contenteditable="true" spellcheck="false"></tbody>
                </table>
            </div>
        </div>
    </main>

<script type="module">
    import { RadarElite } from './modulo-radar.js';
    import { BANCO_ESPELHOS } from './banco-espelhos.js';

    let activeEx = localStorage.getItem('activeEx') || "44";
    let ultimaLinhaFocada = 1;

    const inicializarFolha = () => {
        const corpo = document.getElementById('CORPO_FOLHA_ELITE');
        const regua = document.getElementById('regua-oab');
        corpo.innerHTML = ""; regua.innerHTML = "";

        for(let i = 1; i <= 190; i++) {
            // Inserção de Headers conforme padrão FGV
            if(i === 1) addDiv(corpo, "PEÇA PROFISSIONAL", "header-separador");
            if(i === 51) { addDiv(corpo, "QUESTÃO 1", "header-separador"); addDiv(corpo, "ITEM A/B", "item-separador"); }
            if(i === 81) { addDiv(corpo, "QUESTÃO 2", "header-separador"); addDiv(corpo, "ITEM A/B", "item-separador"); }
            if(i === 111) { addDiv(corpo, "QUESTÃO 3", "header-separador"); addDiv(corpo, "ITEM A/B", "item-separador"); }
            if(i === 141) { addDiv(corpo, "QUESTÃO 4", "header-separador"); addDiv(corpo, "ITEM A/B", "item-separador"); }

            const row = corpo.insertRow();
            const cell = row.insertCell();
            cell.id = `L${i}`;
            cell.onfocus = () => { ultimaLinhaFocada = i; };

            const numDiv = document.createElement('div');
            numDiv.className = "regua-num";
            numDiv.innerText = i;
            regua.appendChild(numDiv);
        }
    };

    const addDiv = (parent, texto, classe) => {
        const row = parent.insertRow();
        row.contentEditable = "false";
        const cell = row.insertCell();
        cell.className = `separador ${classe}`;
        cell.innerText = texto;
        
        const compensador = document.createElement('div');
        compensador.style.height = (classe.includes("header") ? "31px" : "23px");
        document.getElementById('regua-oab').appendChild(compensador);
    };

    window.injetarJustica = () => {
        const dna = BANCO_ESPELHOS[activeEx] || "";
        const analise = RadarElite.analisarGabarito(dna);
        const frases = RadarElite.prepararLinhas(dna);
        
        let start = analise.questao ? analise.questao.linhaAlvo : ultimaLinhaFocada;

        frases.forEach((t, i) => {
            const el = document.getElementById(`L${start + i}`);
            if(el) el.innerText = t;
        });
        
        if(analise.questao) irPara(analise.questao.linhaAlvo);
        alert("JUSTIÇA INJETADA!");
    };

    window.irPara = (n) => {
        const el = document.getElementById(`L${n}`);
        if(el) { el.scrollIntoView({behavior:'smooth', block:'center'}); el.focus(); }
    };

    window.onload = inicializarFolha;
    Object.assign(window, { injetarJustica, irPara });
</script>
</body>
</html>
