<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ARYANNA MASTER ELITE | 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb; --success: #059669; --warning: #f59e0b;
            --bg-dark: #0f172a; --sidebar: #1e293b; --gold: #d4af37;
            --border: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: #f8fafc; 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* HEADER */
        header { 
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px);
            padding: 12px 20px; border-bottom: 2px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center; z-index: 1000;
        }
        .brand { font-weight: 800; font-size: 0.9rem; color: var(--gold); letter-spacing: 1px; }
        #timer { font-family: monospace; font-size: 1.3rem; color: var(--warning); font-weight: bold; }

        /* LAYOUT PRINCIPAL */
        .app-container { flex: 1; display: flex; overflow: hidden; }

        /* SIDEBAR DE RECURSOS (HIST√ìRICO E TESES) */
        .sidebar { 
            width: 300px; background: var(--sidebar); display: flex; flex-direction: column;
            border-right: 1px solid var(--border);
        }
        .sidebar-tabs { display: flex; background: rgba(0,0,0,0.2); }
        .tab-nav { 
            flex: 1; padding: 12px; border: none; background: none; color: #64748b; 
            font-size: 0.7rem; font-weight: bold; cursor: pointer; border-bottom: 2px solid transparent;
        }
        .tab-nav.active { color: var(--gold); border-bottom-color: var(--gold); background: rgba(255,255,255,0.05); }

        .list-container { flex: 1; overflow-y: auto; padding: 15px; }
        .card-item { 
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            padding: 12px; border-radius: 8px; margin-bottom: 10px; cursor: pointer;
            transition: 0.2s;
        }
        .card-item:hover { background: rgba(255,255,255,0.08); border-color: var(--gold); }
        .card-item strong { display: block; font-size: 0.8rem; margin-bottom: 4px; color: #fff; }
        .card-item span { font-size: 0.65rem; color: #64748b; }

        /* √ÅREA DO EDITOR */
        .editor-zone { flex: 1.5; display: flex; flex-direction: column; background: #cbd5e1; }
        .toolbar { 
            background: #fff; padding: 10px 15px; display: flex; gap: 10px; 
            align-items: center; border-bottom: 1px solid #94a3b8;
        }
        .select-custom { 
            padding: 8px; border-radius: 6px; border: 1px solid #cbd5e1; 
            font-size: 0.75rem; font-weight: 600; outline: none; background: #f8fafc;
        }
        .btn { 
            padding: 8px 15px; border-radius: 6px; border: none; font-weight: bold; 
            font-size: 0.7rem; cursor: pointer; transition: 0.2s;
        }
        .btn-primary { background: var(--success); color: white; }

        .paper-viewport { flex: 1; overflow-y: auto; padding: 30px 15px; display: flex; justify-content: center; }
        .fgv-sheet { width: 100%; max-width: 800px; background: white; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; }
        .line-numbers { width: 45px; background: #f1f5f9; border-right: 1px solid #e2e8f0; text-align: center; color: #94a3b8; font-size: 11px; padding-top: 15px; line-height: 25px; }
        .main-textarea { 
            flex: 1; border: none; outline: none; resize: none; padding: 15px 25px;
            font-family: 'Caveat', cursive; font-size: 22px; line-height: 25px;
            background-image: linear-gradient(transparent, transparent 24px, #e2e8f0 25px);
            background-size: 100% 25px; color: #1e293b;
        }

        /* √ÅREA DO PDF */
        .pdf-zone { flex: 1.2; display: flex; flex-direction: column; background: #334155; border-left: 1px solid #000; }
        .pdf-tabs { display: flex; background: #1e293b; padding: 5px 10px 0; gap: 4px; }
        .pdf-tab { 
            padding: 8px 15px; border-radius: 6px 6px 0 0; border: none; 
            background: #0f172a; color: #64748b; font-size: 0.65rem; font-weight: bold; cursor: pointer;
        }
        .pdf-tab.active { background: #fff; color: var(--primary); }
        .pdf-tab-gold { color: var(--gold); }
        .pdf-tab-gold.active { background: var(--gold); color: #000; }

        iframe { flex: 1; border: none; }

        /* CONTADOR */
        #counter { font-size: 10px; font-weight: 800; background: #1e293b; color: #fff; padding: 5px 10px; border-radius: 5px; }

        /* MOBILE FIXES */
        #btn-mobile-pdf { 
            display: none; position: fixed; bottom: 20px; right: 20px; z-index: 2000;
            width: 60px; height: 60px; border-radius: 50%; background: var(--primary);
            color: white; border: 3px solid var(--gold); box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            align-items: center; justify-content: center; font-size: 1.5rem;
        }

        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .pdf-zone { position: fixed; inset: 0; z-index: 1500; display: none; }
            .pdf-zone.active { display: flex; }
            #btn-mobile-pdf { display: flex; }
        }
    </style>
</head>
<body>

<header>
    <div class="brand">ARYANNA <span style="color:#fff; font-weight:300">MASTER ELITE</span></div>
    <div id="timer" onclick="toggleTimer()">05:00:00</div>
    <div id="sync-indicator" style="width:12px; height:12px; background:var(--success); border-radius:50%"></div>
</header>

<div class="app-container">
    <aside class="sidebar">
        <div class="sidebar-tabs">
            <button class="tab-nav active" onclick="switchSidebar('postits', this)">üìå TESES</button>
            <button class="tab-nav" onclick="switchSidebar('historico', this)">üìö HIST√ìRICO</button>
        </div>
        <div id="sidebar-list" class="list-container">
            </div>
        <div style="padding:15px; border-top:1px solid var(--border)">
            <button class="btn btn-primary" style="width:100%" onclick="salvarTeseRapida()">+ SALVAR COMO TESE</button>
        </div>
    </aside>

    <main class="editor-zone">
        <div class="toolbar">
            <select class="select-custom" id="exame-select" onchange="mudarExame(this.value)"></select>
            <select class="select-custom" onchange="mudarModo(this.value)">
                <option value="150">üèãÔ∏è PE√áA (150 LINHAS)</option>
                <option value="120">üìù QUEST√ïES (120 LINHAS)</option>
            </select>
            <select class="select-custom" onchange="inserirEstrutura(this.value)">
                <option value="">‚öñÔ∏è ESTRUTURAS</option>
                <option value="rt">Reclama√ß√£o Trabalhista</option>
                <option value="cont">Contesta√ß√£o</option>
                <option value="ro">Recurso Ordin√°rio</option>
                <option value="ap">Agravo de Peti√ß√£o</option>
            </select>
            <div style="flex:1"></div>
            <div id="counter">0 / 150</div>
            <button class="btn btn-primary" onclick="arquivarEstudo()">SALVAR ESTUDO</button>
        </div>

        <div class="paper-viewport">
            <div class="fgv-sheet">
                <div class="line-numbers" id="line-box"></div>
                <textarea id="main-editor" class="main-textarea" spellcheck="false" oninput="handleInput()"></textarea>
            </div>
        </div>
    </main>

    <section class="pdf-zone" id="pdf-area">
        <div class="pdf-tabs">
            <button class="pdf-tab active" onclick="mudarPdf('prova', this)">PROVA</button>
            <button class="pdf-tab" onclick="mudarPdf('gabarito', this)">GABARITO</button>
            <button class="pdf-tab pdf-tab-gold" onclick="mudarPdf('aryanna', this)">üìô APOSTILA ARYANNA</button>
        </div>
        <iframe id="pdf-viewer" src="about:blank"></iframe>
    </section>
</div>

<button id="btn-mobile-pdf" onclick="document.getElementById('pdf-area').classList.toggle('active')">üìë</button>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        authDomain: "masteroab-db5e1.firebaseapp.com",
        projectId: "masteroab-db5e1",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    window.db = db; window.ref = ref; window.set = set; window.onValue = onValue; window.push = push; window.get = get;

    // Sincroniza√ß√£o do Editor
    onValue(ref(db, 'treino_atual/global'), (s) => {
        if(!window.isTyping) {
            document.getElementById('main-editor').value = s.val() || "";
            atualizarContador();
        }
    });

    // Carregamento Inicial da Sidebar (Teses por padr√£o)
    window.switchSidebar = function(tipo, btn) {
        document.querySelectorAll('.tab-nav').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        const list = document.getElementById('sidebar-list');
        list.innerHTML = 'Carregando...';

        onValue(ref(db, tipo), (s) => {
            list.innerHTML = '';
            const data = s.val() || {};
            Object.keys(data).reverse().forEach(id => {
                const item = data[id];
                const div = document.createElement('div');
                div.className = 'card-item';
                div.innerHTML = `<strong>${item.titulo || item.nome || 'Sem t√≠tulo'}</strong>
                                 <span>${item.data || 'Tese Salva'}</span>`;
                div.onclick = () => {
                    if(tipo === 'historico') {
                        if(confirm("Deseja recuperar este estudo? Isso substituir√° o texto atual.")) {
                            document.getElementById('main-editor').value = item.texto;
                            handleInput();
                        }
                    } else {
                        document.getElementById('main-editor').value += "\n" + item.texto;
                        handleInput();
                    }
                };
                list.appendChild(div);
            });
        });
    };
    
    // Inicia com Teses
    window.onload = () => { switchSidebar('postits', document.querySelector('.tab-nav')); };
</script>

<script>
    let linesMax = 150;
    let exameAtivo = 42;
    let seconds = 18000;
    let timerIdx = null;

    function handleInput() {
        window.isTyping = true;
        document.getElementById('sync-indicator').style.background = 'var(--warning)';
        atualizarContador();
        clearTimeout(window.typeTimeout);
        window.typeTimeout = setTimeout(() => {
            window.set(window.ref(window.db, 'treino_atual/global'), document.getElementById('main-editor').value);
            document.getElementById('sync-indicator').style.background = 'var(--success)';
            window.isTyping = false;
        }, 1000);
    }

    function atualizarContador() {
        const lines = document.getElementById('main-editor').value.split('\n').length;
        document.getElementById('counter').innerText = `${lines} / ${linesMax}`;
    }

    function mudarModo(val) {
        linesMax = parseInt(val);
        gerarLinhas(linesMax);
        atualizarContador();
    }

    function mudarPdf(tipo, btn) {
        document.querySelectorAll('.pdf-tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        const f = document.getElementById('pdf-viewer');
        if(tipo === 'prova') f.src = `ro${exameAtivo}.pdf`;
        else if(tipo === 'gabarito') f.src = `ro${exameAtivo}-gabarito.pdf`;
        else f.src = `Aryanna Linhares.pdf`;
    }

    function mudarExame(v) { exameAtivo = v; mudarPdf('prova', document.querySelector('.pdf-tab')); }

    function inserirEstrutura(tipo) {
        const est = {
            rt: "AO JU√çZO DA... VARA DO TRABALHO DE...\n\nRECLAMANTE..., nacionalidade..., estado civil...",
            cont: "AO JU√çZO DA... VARA DO TRABALHO DE...\nPROCESSO N¬∫...\n\nRECLAMADO..., j√° qualificado...",
            ro: "AO JU√çZO DA... VARA DO TRABALHO DE...\nPROCESSO N¬∫...\n\nRECORRENTE..., inconformado com a senten√ßa...",
            ap: "AO JU√çZO DA... VARA DO TRABALHO DE...\nPROCESSO N¬∫...\n\nAGRAVANTE..., nos autos da execu√ß√£o..."
        };
        if(est[tipo]) { document.getElementById('main-editor').value = est[tipo]; handleInput(); }
    }

    function arquivarEstudo() {
        const tit = prompt("D√™ um nome para este estudo:");
        if(!tit) return;
        const texto = document.getElementById('main-editor').value;
        const data = new Date().toLocaleString('pt-BR');
        window.push(window.ref(window.db, 'historico'), { titulo: tit, texto, data });
        alert("Estudo salvo no Hist√≥rico!");
    }

    function salvarTeseRapida() {
        const nome = prompt("Nome da Tese/Post-it:");
        if(!nome) return;
        const texto = document.getElementById('main-editor').value;
        window.push(window.ref(window.db, 'postits'), { nome, texto });
    }

    function gerarLinhas(n) {
        let h = ""; for(let i=1; i<=n; i++) h += i + "<br>";
        document.getElementById('line-box').innerHTML = h;
    }

    function toggleTimer() {
        if(timerIdx) { clearInterval(timerIdx); timerIdx = null; }
        else { timerIdx = setInterval(() => { seconds--; updateClock(); }, 1000); }
    }

    function updateClock() {
        const h = Math.floor(seconds/3600); const m = Math.floor((seconds%3600)/60); const s = seconds%60;
        document.getElementById('timer').innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    // Setup inicial dos Exames
    const sel = document.getElementById('exame-select');
    for(let i=45; i>=35; i--) {
        const opt = document.createElement('option');
        opt.value = i; opt.innerText = `EXAME ${i}`;
        if(i==42) opt.selected = true;
        sel.appendChild(opt);
    }
    gerarLinhas(150);
    mudarPdf('prova', document.querySelector('.pdf-tab'));
</script>
</body>
</html>
