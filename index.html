<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aryanna Master Pro - OAB</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css">
    <style>
        :root { --primary: #2c3e50; --accent: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        #sidebar { width: 300px; background: var(--primary); color: white; padding: 15px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
        .btn-peca { background: #34495e; border: none; color: white; padding: 10px; text-align: left; cursor: pointer; border-radius: 4px; width: 100%; }
        
        #main-content { flex: 1; display: flex; flex-direction: column; padding: 20px; gap: 15px; }
        #editor { flex: 1; padding: 20px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; line-height: 1.5; resize: none; background: #fff; }

        /* Painel PDF */
        #pdf-panel { flex: 1.2; background: #525659; display: flex; flex-direction: column; border-left: 2px solid #333; }
        #pdf-controls { background: #333; color: white; padding: 8px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        #pdf-viewer { flex: 1; overflow: auto; position: relative; background: #525659; display: flex; justify-content: center; }
        .pdf-page-wrapper { position: relative; margin: 15px auto; box-shadow: 0 0 10px rgba(0,0,0,0.5); background: white; }
        .textLayer { opacity: 1; mix-blend-mode: multiply; }

        #espelho-container { width: 350px; background: #fff; border-left: 2px solid #ddd; padding: 15px; overflow-y: auto; }
        #nota-final { font-size: 24px; text-align: center; padding: 20px; background: var(--primary); color: white; border-radius: 8px; margin-top: 10px; }
        .post-it { background: #fffa90; padding: 10px; border-radius: 5px; margin-bottom: 10px; color: #333; font-size: 14px; border-left: 5px solid #f1c40f; }
    </style>
</head>
<body>

    <aside id="sidebar">
        <h3>Pe√ßas Base</h3>
        <button class="btn-peca" onclick="carregarEstrutura('RT')">Reclama√ß√£o Trabalhista</button>
        <button class="btn-peca" onclick="carregarEstrutura('CON')">Contesta√ß√£o</button>
        <button class="btn-peca" onclick="carregarEstrutura('RO')">Recurso Ordin√°rio</button>
        <hr>
        <div id="meus-postits"></div>
        <button class="btn-peca" style="background:var(--accent)" onclick="addPostIt()">+ Novo Lembrete</button>
        <hr>
        <label>Vade Mecum (PDF):</label>
        <input type="file" id="file-upload" accept="application/pdf">
    </aside>

    <main id="main-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <select id="select-espelho" onchange="carregarEspelho(this.value)">
                <option value="">Selecione a Prova...</option>
                <option value="44">44¬∫ Exame</option>
                <option value="41">41¬∫ Exame</option>
                <option value="40">40¬∫ Exame</option>
            </select>
            <button onclick="salvarProgresso()">üíæ Salvar</button>
        </div>
        <textarea id="editor" placeholder="Redija sua pe√ßa..."></textarea>
    </main>

    <section id="pdf-panel">
        <div id="pdf-controls">
            <button onclick="PDFEngine.changePage(-1)">‚ùÆ</button>
            <input type="number" id="page-num" value="1" onchange="PDFEngine.goToPage(this.value)">
            <span>/ <span id="page-count">0</span></span>
            <button onclick="PDFEngine.changePage(1)">‚ùØ</button>
        </div>
        <div id="pdf-viewer">
            <div class="pdf-page-wrapper">
                <canvas id="pdf-canvas"></canvas>
                <div id="text-layer" class="textLayer"></div>
            </div>
        </div>
    </section>

    <section id="espelho-container">
        <div id="itens-espelho"></div>
        <div id="nota-final">Nota: 0,00</div>
    </section>

    <script type="module">
        import { DATA_MASTER } from './estruturas.js';
        import { PDFEngine } from './pdf-engine.js';

        // Configura√ß√£o PDF.js Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Expor para o HTML
        window.PDFEngine = PDFEngine;

        window.carregarEstrutura = (t) => {
            if(confirm("Substituir texto?")) document.getElementById('editor').value = DATA_MASTER.estruturas[t];
        };

        window.carregarEspelho = (id) => {
            document.getElementById('itens-espelho').innerHTML = DATA_MASTER.espelhos[id] || "";
            window.calcNota();
        };

        window.calcNota = () => {
            let total = 0;
            document.querySelectorAll('#itens-espelho input:checked').forEach(c => total += parseFloat(c.value));
            document.getElementById('nota-final').innerText = `Nota: ${total.toFixed(2)}`;
        };

        window.addPostIt = () => {
            const msg = prompt("Dica:");
            if(msg) {
                const div = document.createElement('div');
                div.className = 'post-it';
                div.innerHTML = `üìå ${msg}`;
                document.getElementById('meus-postits').appendChild(div);
                localStorage.setItem('postits_salvos', document.getElementById('meus-postits').innerHTML);
            }
        };

        window.salvarProgresso = () => {
            localStorage.setItem('treino_oab', document.getElementById('editor').value);
            alert("Salvo!");
        };

        document.getElementById('file-upload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const buffer = await file.arrayBuffer();
                PDFEngine.init(buffer);
            }
        });

        window.onload = () => {
            document.getElementById('editor').value = localStorage.getItem('treino_oab') || "";
            document.getElementById('meus-postits').innerHTML = localStorage.getItem('postits_salvos') || "";
        };
    </script>
</body>
</html>
