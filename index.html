<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARYANNA MASTER PRO | FIXED</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Courier+Prime&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb; --success: #059669; --warning: #f59e0b; --danger: #dc2626;
            --bg-site: #0f172a; --gold: #d4af37;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-site); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* BARRA DE COMANDO FIXA (ESTILO APP) */
        .master-toolbar { 
            background: #1e293b; 
            padding: 5px; 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 5px; 
            border-bottom: 2px solid var(--gold);
            z-index: 9999;
        }

        .btn-top { 
            height: 45px; 
            border: none; 
            border-radius: 6px; 
            font-weight: 800; 
            font-size: 0.65rem; 
            color: white; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
        }
        .btn-save { background: var(--primary); }
        .btn-post { background: var(--warning); color: #000; }
        .btn-check { background: var(--success); }
        .btn-pdf { background: #475569; }

        /* SELETORES */
        .sub-bar { 
            background: #fff; 
            padding: 5px; 
            display: flex; 
            gap: 5px; 
        }
        select { 
            flex: 1; 
            height: 35px; 
            font-size: 0.7rem; 
            font-weight: bold; 
            border: 1px solid #ccc; 
            border-radius: 4px;
        }

        .main-content { flex: 1; display: flex; overflow: hidden; flex-direction: column; }
        
        /* √ÅREA DA FOLHA */
        .editor-container { flex: 1; overflow-y: auto; background: #cbd5e1; padding: 10px; position: relative; }
        .paper-sheet { 
            width: 100%; 
            max-width: 800px; 
            margin: 0 auto;
            min-height: 1200px; 
            background: #fff; 
            display: flex; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .line-nums { width: 35px; background: #f1f5f9; border-right: 1px solid #ddd; text-align: center; font-size: 11px; color: #94a3b8; padding-top: 15px; line-height: 28px; }
        .text-area { flex: 1; border: none; outline: none; padding: 15px; font-family: 'Courier Prime', monospace; font-size: 17px; line-height: 28px; background-image: linear-gradient(transparent, transparent 27px, #eee 28px); background-size: 100% 28px; resize: none; }

        /* PDF MODAL (PARA N√ÉO SUMIR) */
        #pdf-overlay { 
            position: fixed; top: 105px; left: 0; width: 100%; height: calc(100% - 105px); 
            background: #fff; z-index: 999; display: none; 
        }
        .pdf-header { background: #0f172a; padding: 10px; display: flex; gap: 5px; }
        .close-pdf { background: var(--danger); color: white; border: none; padding: 5px 15px; border-radius: 4px; font-weight: bold; }

        /* POST-IT OVERLAY */
        .postit-overlay { 
            position: fixed; top: 110px; right: 10px; width: 250px; 
            background: var(--warning); padding: 10px; border-radius: 8px; 
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5); display: none; z-index: 1000;
        }
    </style>
</head>
<body>

    <div class="master-toolbar">
        <button class="btn-top btn-save" onclick="salvarModelo()">üíæ<br>SALVAR</button>
        <button class="btn-top btn-pdf" onclick="abrirPDF()">üìÑ<br>PDF/VADE</button>
        <button class="btn-top btn-post" onclick="togglePostit()">üìå<br>POST-IT</button>
        <button class="btn-top btn-check" onclick="finalizar()">‚úÖ<br>FIM</button>
    </div>

    <div class="sub-bar">
        <select id="exame" onchange="mudarExame(this.value)"></select>
        <select id="peca-tipo" onchange="carregarEstrutura(this.value)">
            <option value="">üìÇ ESTRUTURAS</option>
            <option value="rt">RT Ordin√°ria</option>
            <option value="contestacao">Contesta√ß√£o</option>
            <option value="ro">Recurso Ordin√°rio</option>
            <option value="ap">Agravo de Peti√ß√£o</option>
        </select>
    </div>

    <div class="main-content">
        <div class="editor-container">
            <div class="paper-sheet">
                <div class="line-nums" id="lines"></div>
                <textarea id="editor" class="text-area" spellcheck="false" oninput="autoSave()"></textarea>
            </div>
        </div>
    </div>

    <div id="pdf-overlay">
        <div class="pdf-header">
            <button class="close-pdf" onclick="fecharPDF()">FECHAR X</button>
            <button class="btn-top btn-pdf" style="flex:1" onclick="loadPDF('prova')">PROVA</button>
            <button class="btn-top btn-pdf" style="flex:1" onclick="loadPDF('gab')">GAB</button>
            <button class="btn-top btn-pdf" style="flex:1; background:var(--gold); color:000;" onclick="loadPDF('ary')">VADE</button>
        </div>
        <iframe id="pdf-frame" style="width:100%; height:100%; border:none;"></iframe>
    </div>

    <div id="postit-box" class="postit-overlay">
        <div id="lista-notas" style="max-height: 200px; overflow-y: auto; background: rgba(255,255,255,0.3); margin-bottom: 5px; font-size: 0.7rem; color: #000;"></div>
        <input type="text" id="nota-input" placeholder="Nova dica/tese..." style="width:100%; margin-bottom:5px;">
        <button onclick="salvarNota()" style="width:100%; background:#000; color:#fff; border:none; padding:5px;">SALVAR NOTA</button>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    const config = { apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", authDomain: "masteroab-db5e1.firebaseapp.com", projectId: "masteroab-db5e1", databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" };
    const app = initializeApp(config); const db = getDatabase(app);
    window.db_ops = { ref, set, push, get, db };

    onValue(ref(db, 'v3_treino/peca'), (s) => { if(!window.editando) document.getElementById('editor').value = s.val() || ""; });
    onValue(ref(db, 'notas_fgv'), (s) => renderNotas(s.val()));
</script>

<script>
    let exameAtivo = 42; let pecaAtiva = "";

    function abrirPDF() { document.getElementById('pdf-overlay').style.display = 'block'; loadPDF('prova'); }
    function fecharPDF() { document.getElementById('pdf-overlay').style.display = 'none'; }
    function togglePostit() { 
        const b = document.getElementById('postit-box');
        b.style.display = b.style.display === 'block' ? 'none' : 'block';
    }

    function loadPDF(tipo) {
        const f = document.getElementById('pdf-frame');
        if(tipo === 'prova') f.src = `ro${exameAtivo}.pdf`;
        if(tipo === 'gab') f.src = `ro${exameAtivo}-gabarito.pdf`;
        if(tipo === 'ary') f.src = `Aryanna Linhares.pdf`;
    }

    async function carregarEstrutura(k) {
        if(!k) return; pecaAtiva = k;
        const s = await window.db_ops.get(window.db_ops.ref(window.db_ops.db, `modelos_mestre/${k}`));
        document.getElementById('editor').value = s.exists() ? s.val() : "Estrutura de " + k.toUpperCase();
    }

    async function salvarModelo() {
        if(!pecaAtiva) return alert("Selecione uma pe√ßa!");
        await window.db_ops.set(window.db_ops.ref(window.db_ops.db, `modelos_mestre/${pecaAtiva}`), document.getElementById('editor').value);
        alert("Estrutura Salva!");
    }

    async function salvarNota() {
        const t = document.getElementById('nota-input').value;
        if(t) await window.db_ops.push(window.db_ops.ref(window.db_ops.db, 'notas_fgv'), { texto: t });
        document.getElementById('nota-input').value = "";
    }

    function renderNotas(d) {
        const c = document.getElementById('lista-notas'); c.innerHTML = "";
        if(d) Object.keys(d).forEach(k => { c.innerHTML += `<div>‚Ä¢ ${d[k].texto}</div>`; });
    }

    function autoSave() {
        window.editando = true; clearTimeout(window.sv);
        window.sv = setTimeout(() => {
            window.db_ops.set(window.db_ops.ref(window.db_ops.db, 'v3_treino/peca'), document.getElementById('editor').value);
            window.editando = false;
        }, 800);
    }

    function mudarExame(v) { exameAtivo = v; if(document.getElementById('pdf-overlay').style.display === 'block') loadPDF('prova'); }

    window.onload = () => {
        let h = ""; for(let i=1; i<=150; i++) h += i + "<br>"; document.getElementById('lines').innerHTML = h;
        const s = document.getElementById('exame');
        for(let i=44; i>=35; i--) { 
            let o = document.createElement('option'); o.value=i; o.innerText=`EXAME ${i}`; 
            if(i==42) o.selected=true; s.appendChild(o); 
        }
    };
</script>
</body>
</html>
