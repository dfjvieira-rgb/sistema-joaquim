<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARYANNA RAIZ | MOBILE</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; margin: 0; padding: 0; color: #fff; }
        
        /* BARRA DE COMANDO SEMPRE VIS√çVEL */
        .nav-header { background: #1e293b; padding: 10px; border-bottom: 3px solid #d4af37; position: sticky; top: 0; z-index: 1000; }
        .button-group { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
        
        .btn { flex: 1; min-width: 80px; height: 45px; border-radius: 8px; border: none; font-weight: bold; font-size: 11px; cursor: pointer; color: white; text-transform: uppercase; }
        .btn-save { background: #2563eb; }
        .btn-note { background: #f59e0b; color: #000; }
        .btn-pdf { background: #475569; }
        .btn-finish { background: #059669; }
        
        .selectors { display: flex; gap: 5px; }
        select { flex: 1; height: 38px; border-radius: 5px; font-weight: bold; background: #fff; font-size: 12px; }

        /* √ÅREA DE CONTE√öDO */
        .content { padding: 10px; }
        
        /* POST-ITS (Aparecem em cima da folha se ativos) */
        .panel { background: #fff9c4; color: #000; padding: 10px; border-radius: 5px; margin-bottom: 10px; display: none; border-left: 8px solid #f59e0b; }
        .panel-list { max-height: 100px; overflow-y: auto; font-size: 12px; margin-bottom: 5px; background: rgba(0,0,0,0.05); padding: 5px; }

        /* A FOLHA FGV */
        .paper { background: #fff; color: #334155; display: flex; box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-height: 1000px; width: 100%; border-radius: 4px; overflow: hidden; }
        .lines { width: 35px; background: #f8fafc; border-right: 1px solid #ddd; text-align: center; font-size: 11px; color: #94a3b8; padding-top: 15px; line-height: 28px; }
        .textarea { flex: 1; border: none; outline: none; padding: 15px; font-family: 'Courier Prime', monospace; font-size: 17px; line-height: 28px; background-image: linear-gradient(transparent, transparent 27px, #eee 28px); background-size: 100% 28px; resize: none; overflow-y: hidden; }

        /* O VISUALIZADOR DE PDF */
        .pdf-box { margin-top: 20px; background: #1e293b; border-radius: 8px; padding: 5px; }
        .pdf-tabs { display: flex; gap: 2px; margin-bottom: 5px; }
        .tab { flex: 1; padding: 10px; font-size: 10px; border: none; background: #334155; color: #fff; font-weight: bold; border-radius: 4px; }
        .tab.active { background: #d4af37; color: #000; }
        iframe { width: 100%; height: 500px; background: #fff; border-radius: 4px; border: none; }
    </style>
</head>
<body>

<div class="nav-header">
    <div class="button-group">
        <button class="btn btn-save" onclick="salvarModelo()">Salvar Pe√ßa</button>
        <button class="btn btn-note" onclick="togglePanel()">Post-its</button>
        <button class="btn btn-pdf" onclick="window.scrollTo(0, document.body.scrollHeight)">Ver PDF</button>
        <button class="btn btn-finish" onclick="finalizar()">Finalizar</button>
    </div>
    <div class="selectors">
        <select id="selExame" onchange="atualizarExame(this.value)"></select>
        <select id="selPeca" onchange="carregarPeca(this.value)">
            <option value="">üìÇ ESTRUTURAS</option>
            <option value="rt">RT Ordin√°ria</option>
            <option value="contestacao">Contesta√ß√£o</option>
            <option value="ro">Recurso Ordin√°rio</option>
            <option value="ap">Agravo de Peti√ß√£o</option>
        </select>
    </div>
</div>

<div class="content">
    <div id="postitPanel" class="panel">
        <div id="listaNotas" class="panel-list"></div>
        <input type="text" id="inputNota" placeholder="Nova dica..." style="width:75%; height:30px;">
        <button onclick="addNota()" style="width:20%; height:34px; background:#000; color:#fff; border:none;">ADD</button>
    </div>

    <div class="paper">
        <div id="lineNums" class="lines"></div>
        <textarea id="mainEditor" class="textarea" spellcheck="false" oninput="autoSave(); ajustarAltura(this)"></textarea>
    </div>

    <div class="pdf-box">
        <div class="pdf-tabs">
            <button class="tab active" id="t-prova" onclick="trocarPDF('prova')">PROVA</button>
            <button class="tab" id="t-gab" onclick="trocarPDF('gab')">GABARITO</button>
            <button class="tab" id="t-ary" onclick="trocarPDF('ary')" style="background:#d4af37; color:#000;">VADE ARY</button>
        </div>
        <iframe id="pdfFrame"></iframe>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    const config = { apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", authDomain: "masteroab-db5e1.firebaseapp.com", projectId: "masteroab-db5e1", databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" };
    const app = initializeApp(config); const db = getDatabase(app);
    window.db_ops = { ref, set, push, get, db };

    onValue(ref(db, 'v3_treino/peca'), (s) => { if(!window.isEditing) document.getElementById('mainEditor').value = s.val() || ""; ajustarAltura(document.getElementById('mainEditor')); });
    onValue(ref(db, 'notas_fgv'), (s) => renderNotas(s.val()));
</script>

<script>
    let exame = 42; let peca = "";

    function trocarPDF(tipo) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        const f = document.getElementById('pdfFrame');
        if(tipo === 'prova') { f.src = `ro${exame}.pdf`; document.getElementById('t-prova').classList.add('active'); }
        if(tipo === 'gab') { f.src = `ro${exame}-gabarito.pdf`; document.getElementById('t-gab').classList.add('active'); }
        if(tipo === 'ary') { f.src = `Aryanna Linhares.pdf`; document.getElementById('t-ary').classList.add('active'); }
    }

    async function carregarPeca(k) {
        if(!k) return; peca = k;
        const s = await window.db_ops.get(window.db_ops.ref(window.db_ops.db, `modelos_mestre/${k}`));
        document.getElementById('mainEditor').value = s.exists() ? s.val() : "ESTRUTURA: " + k.toUpperCase();
        ajustarAltura(document.getElementById('mainEditor'));
    }

    async function salvarModelo() {
        if(!peca) return alert("Selecione a pe√ßa!");
        await window.db_ops.set(window.db_ops.ref(window.db_ops.db, `modelos_mestre/${peca}`), document.getElementById('mainEditor').value);
        alert("Salvo!");
    }

    function togglePanel() { 
        const p = document.getElementById('postitPanel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    async function addNota() {
        const v = document.getElementById('inputNota').value;
        if(v) await window.db_ops.push(window.db_ops.ref(window.db_ops.db, 'notas_fgv'), { texto: v });
        document.getElementById('inputNota').value = "";
    }

    function renderNotas(d) {
        const c = document.getElementById('listaNotas'); c.innerHTML = "";
        if(d) Object.keys(d).forEach(k => { c.innerHTML += `<div>‚Ä¢ ${d[k].texto}</div>`; });
    }

    function ajustarAltura(el) { el.style.height = 'auto'; el.style.height = (el.scrollHeight) + 'px'; }

    function autoSave() {
        window.isEditing = true; clearTimeout(window.sv);
        window.sv = setTimeout(() => {
            window.db_ops.set(window.db_ops.ref(window.db_ops.db, 'v3_treino/peca'), document.getElementById('mainEditor').value);
            window.isEditing = false;
        }, 800);
    }

    function atualizarExame(v) { exame = v; trocarPDF('prova'); }

    window.onload = () => {
        let l = ""; for(let i=1; i<=150; i++) l += i + "<br>"; document.getElementById('lineNums').innerHTML = l;
        const s = document.getElementById('selExame');
        for(let i=44; i>=35; i--) {
            let o = document.createElement('option'); o.value=i; o.innerText=`EXAME ${i}`;
            if(i==42) o.selected=true; s.appendChild(o);
        }
        trocarPDF('prova');
    };
</script>
</body>
</html>
