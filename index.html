<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ARYANNA MASTER PRO | 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Courier+Prime&swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root{--primary:#2563eb;--success:#059669;--warning:#f59e0b;--bg-site:#f8fafc;--gold:#d4af37;--pen-blue:#1e3a8a;--paper:#ffffff;--text:#1e293b;--toolbar-bg:#ffffff;--border:#cbd5e1}.dark-mode{--paper:#1e293b;--pen-blue:#93c5fd;--bg-site:#0f172a;--text:#f1f5f9;--toolbar-bg:#1e293b;--border:#334155}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Inter',sans-serif;background:var(--bg-site);height:100vh;display:flex;flex-direction:column;overflow:hidden;color:var(--text)}header{background:#1e293b;padding:0 15px;border-bottom:2px solid var(--gold);display:flex;justify-content:space-between;align-items:center;height:45px;z-index:1001}.logo{font-weight:800;color:var(--gold);font-size:.8rem}.main-container{flex:1;display:flex;overflow:hidden;position:relative}.editor-section{flex:1;display:flex;flex-direction:column;background:var(--bg-site);border-right:1px solid var(--border);min-width:0}.toolbar{background:var(--toolbar-bg);padding:8px;display:flex;gap:5px;border-bottom:1px solid var(--border);align-items:center;overflow-x:auto}.btn-symbol{height:36px;min-width:40px;border-radius:8px;border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.1rem;background:var(--toolbar-bg);color:var(--text);flex-shrink:0}.paper-wrapper{flex:1;overflow-y:auto;padding:10px;background:rgba(0,0,0,.1)}.paper-sheet{width:100%;max-width:800px;background:var(--paper);min-height:2500px;display:flex;margin:0 auto;box-shadow:0 4px 15px rgba(0,0,0,.2)}.line-nums{width:35px;background:rgba(0,0,0,.03);border-right:1px solid var(--border);text-align:center;color:#94a3b8;font-size:11px;padding-top:15px;line-height:28px}.text-area{flex:1;border:none;outline:none;padding:11px 15px;font-size:16px;line-height:28px;color:var(--pen-blue);background-image:linear-gradient(transparent,transparent 27px,var(--border) 28px);background-size:100% 28px;background-attachment:local;resize:none;background-color:transparent}.viewer-section{flex:1.2;display:flex;flex-direction:column;background:#334155;min-width:0;position:relative}.tabs{display:flex;background:#1e293b;padding:5px 5px 0;gap:3px;z-index:10}.tab{padding:8px 12px;border:none;border-radius:5px 5px 0 0;background:#0f172a;color:#94a3b8;font-size:.7rem;cursor:pointer}.tab.active{background:var(--bg-site);color:var(--primary);font-weight:700}#pdf-viewport{flex:1;overflow-y:auto;background:#525659;padding:10px 0}.page-container{position:relative;margin:0 auto 15px;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.3);overflow:hidden}canvas{display:block;width:100%!important;height:auto!important}.modal-full{display:none;position:fixed;inset:0;background:var(--bg-site);z-index:9999;flex-direction:column}.modal-header{background:#1e293b;color:#fff;padding:0 15px;display:flex;align-items:center;border-bottom:2px solid var(--gold);height:50px;gap:10px}.modal-body{flex:1;overflow-y:auto;padding:15px}.espelho-item{background:var(--paper);border:1px solid var(--border);padding:10px;margin-bottom:8px;border-radius:6px;display:flex;align-items:center;gap:10px}.espelho-pt{font-weight:800;color:var(--primary);font-size:.75rem}.nota-floating{position:sticky;top:0;background:var(--gold);color:#000;padding:10px;text-align:center;font-weight:900;border-radius:8px;margin-bottom:15px;z-index:10}
    </style>
</head>
<body class="dark-mode">

<header>
    <div class="logo">ARYANNA MASTER 2026</div>
    <div id="timer-display" style="color:var(--warning);font-family:'Courier Prime';font-weight:700">05:00:00</div>
</header>

<div class="main-container">
    <section class="editor-section">
        <div class="toolbar">
            <select id="exam-select" class="btn-symbol" style="width: auto; padding: 0 10px;"></select>
            <button class="btn-symbol" id="btn-pecas" title="Estruturas">‚öñÔ∏è</button>
            <button class="btn-symbol" id="btn-respostas" title="Respostas">üìö</button>
            <button class="btn-symbol" id="btn-espelho" title="Espelho">üéØ</button>
            <button class="btn-symbol" id="btn-dicas" title="Dicas">üí°</button>
            <button class="btn-symbol" id="btn-nc" title="Post-its">üìå</button>
            <button class="btn-symbol" id="btn-mentoria" title="Mentoria">üèÜ</button>
            <button class="btn-symbol" style="background:var(--success);color:#fff;margin-left:auto;" id="btn-save">üíæ</button>
        </div>
        <div class="paper-wrapper">
            <div class="paper-sheet">
                <div class="line-nums" id="ln-main"></div>
                <textarea id="texto-final" class="text-area" spellcheck="false" placeholder="Inicie sua pe√ßa..."></textarea>
            </div>
        </div>
    </section>

    <section class="viewer-section" id="section-pdf">
        <div class="tabs">
            <button id="tab-prova" class="tab active">PROVA</button>
            <button id="tab-gabarito" class="tab">GABARITO</button>
            <button id="tab-vade" class="tab">VADE</button>
        </div>
        <div id="pdf-viewport"></div>
    </section>
</div>

<div id="menu-estruturas" style="display:none;position:absolute;top:95px;left:55px;background:var(--toolbar-bg);border-radius:8px;box-shadow:0 5px 20px rgba(0,0,0,.3);z-index:5000;width:250px;border:1px solid var(--border);max-height:60vh;overflow-y:auto"></div>

<div id="modal-espelho" class="modal-full"><div class="modal-header"><button class="btn-fechar" data-modal="modal-espelho">‚Üê VOLTAR</button><h3>ESPELHO FGV</h3></div><div class="modal-body"><div class="nota-floating">NOTA: <span id="nota-valor">0.00</span> / 5.00</div><div id="checklist-fgv"></div></div></div>
<div id="modal-respostas" class="modal-full"><div class="modal-header"><button class="btn-fechar" data-modal="modal-respostas">‚Üê VOLTAR</button><h3>FOLHA DE RESPOSTAS</h3></div><div class="modal-body"><div class="paper-sheet"><div class="line-nums" id="ln-res"></div><textarea id="res-editor" class="text-area"></textarea></div></div></div>
<div id="modal-dicas" class="modal-full"><div class="modal-header"><button class="btn-fechar" data-modal="modal-dicas">‚Üê VOLTAR</button><h3>DICAS</h3></div><div class="modal-body"><div class="paper-sheet"><div class="line-nums" id="ln-dicas"></div><textarea id="dicas-editor" class="text-area"></textarea></div></div></div>
<div id="modal-nc" class="modal-full"><div class="modal-header"><button class="btn-fechar" data-modal="modal-nc">‚Üê VOLTAR</button><h3>POST-ITS</h3></div><div class="modal-body"><div id="box-teses"></div><button id="add-tese">+ Tese</button><div id="box-explica"></div><button id="add-detalhe">+ Detalhe</button></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const config = { apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", authDomain: "masteroab-db5e1.firebaseapp.com", projectId: "masteroab-db5e1", databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" };
const app = initializeApp(config); const db = getDatabase(app);
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

const QUALIF = "nacionalidade..., estado civil..., profiss√£o..., portador da c√©dula de identidade RG n¬∫..., inscrito no CPF sob o n¬∫..., endere√ßo eletr√¥nico..., residente e domiciliado na...";
const SALTO = "\n\n\n\n\n\n\n\n\n\n";

const pecas = {
    'RECLAMA√á√ÉO TRABALHISTA': `AO JU√çZO DA... VARA DO TRABALHO DE...${SALTO}RECLAMANTE, ${QUALIF}, vem propor RT...`,
    'CONTESTA√á√ÉO': `AO JU√çZO DA... VARA DO TRABALHO DE...${SALTO}Processo n¬∫...\nRECLAMADA, j√° qualificada, vem apresentar CONTESTA√á√ÉO...`,
    'RECURSO ORDIN√ÅRIO': `AO JU√çZO DA... VARA DO TRABALHO DE...${SALTO}Processo n¬∫...\nRECORRENTE, vem interpor RECURSO ORDIN√ÅRIO...`,
    'AGRAVO DE PETI√á√ÉO': `AO JU√çZO DA... VARA DO TRABALHO DE...${SALTO}Processo n¬∫...\nAGRAVANTE, vem interpor AGRAVO DE PETI√á√ÉO...`
};

window.MEUS_ESPELHOS = {
    "44": `<div class="espelho-item"><input type="checkbox" value="0.10" class="chk-nota"><span>Endere√ßamento 150¬™ VT Manaus (0.10)</span></div>`,
    "41": `<div class="espelho-item"><input type="checkbox" value="0.70" class="chk-nota"><span>IDPJ de Of√≠cio - Ilegal (0.70)</span></div>`,
    "40": `<div class="espelho-item"><input type="checkbox" value="0.50" class="chk-nota"><span>Reconhecimento V√≠nculo (0.50)</span></div>`
};

// --- FUN√á√ïES DE NAVEGA√á√ÉO E MODAIS ---
const abrirModal = id => document.getElementById(id).style.display = 'flex';
const fecharModal = id => document.getElementById(id).style.display = 'none';

// --- C√ÅLCULO DE NOTA ---
const atualizarNota = () => {
    let t = 0; document.querySelectorAll('.chk-nota:checked').forEach(i => t += parseFloat(i.value));
    document.getElementById('nota-valor').innerText = t.toFixed(2);
};

// --- L√ìGICA DE PDF ---
let currentPdf = null;
const carregarPDF = async (tipo) => {
    const ex = document.getElementById('exam-select').value;
    const arq = tipo === 'prova' ? `ro${ex}.pdf` : tipo === 'gabarito' ? `ro${ex}-gabarito.pdf` : `vade.pdf`;
    const v = document.getElementById('pdf-viewport'); v.innerHTML = "Carregando...";
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(`tab-${tipo}`).classList.add('active');
    try {
        currentPdf = await pdfjsLib.getDocument(arq).promise;
        v.innerHTML = "";
        for (let i = 1; i <= currentPdf.numPages; i++) {
            const page = await currentPdf.getPage(i);
            const vp = page.getViewport({ scale: 1.5 });
            const c = document.createElement('div'); c.className = 'page-container';
            const canvas = document.createElement('canvas');
            canvas.height = vp.height; canvas.width = vp.width;
            c.appendChild(canvas); v.appendChild(c);
            await page.render({ canvasContext: canvas.getContext('2d'), viewport: vp }).promise;
        }
    } catch(e) { v.innerHTML = "<p style='color:#fff;padding:20px'>Arquivo n√£o dispon√≠vel.</p>"; }
};

// --- SINCRONIZA√á√ÉO FIREBASE ---
const mudarExame = () => {
    const ex = document.getElementById('exam-select').value;
    carregarPDF('prova');
    document.getElementById('checklist-fgv').innerHTML = window.MEUS_ESPELHOS[ex] || 'Espelho n√£o cadastrado.';
    document.getElementById('nota-valor').innerText = "0.00";
    
    get(ref(db, `v3_treino/exame_${ex}`)).then(s => document.getElementById('texto-final').value = s.val() || "");
    get(ref(db, `v3_respostas/exame_${ex}`)).then(s => document.getElementById('res-editor').value = s.val() || "");
    get(ref(db, `v3_dicas/exame_${ex}`)).then(s => document.getElementById('dicas-editor').value = s.val() || "");
};

const salvarTudo = () => {
    const ex = document.getElementById('exam-select').value;
    set(ref(db, `v3_treino/exame_${ex}`), document.getElementById('texto-final').value);
    set(ref(db, `v3_respostas/exame_${ex}`), document.getElementById('res-editor').value);
    set(ref(db, `v3_dicas/exame_${ex}`), document.getElementById('dicas-editor').value);
    alert("Progresso salvo!");
};

// --- BINDING DE EVENTOS (MAIS SEGURO) ---
document.getElementById('btn-pecas').onclick = () => {
    const m = document.getElementById('menu-estruturas');
    m.style.display = m.style.display === 'none' ? 'block' : 'none';
    m.innerHTML = Object.keys(pecas).map(k => `<div style="padding:12px; border-bottom:1px solid var(--border); cursor:pointer;" class="item-peca" data-key="${k}">${k}</div>`).join('');
    
    document.querySelectorAll('.item-peca').forEach(el => {
        el.onclick = () => {
            const txt = pecas[el.dataset.key];
            document.getElementById('texto-final').value = txt;
            m.style.display = 'none';
        };
    });
};

document.getElementById('btn-respostas').onclick = () => abrirModal('modal-respostas');
document.getElementById('btn-espelho').onclick = () => abrirModal('modal-espelho');
document.getElementById('btn-dicas').onclick = () => abrirModal('modal-dicas');
document.getElementById('btn-nc').onclick = () => abrirModal('modal-nc');
document.getElementById('btn-mentoria').onclick = () => window.location.href = 'mentoria.html';
document.getElementById('btn-save').onclick = salvarTudo;

document.querySelectorAll('.btn-fechar').forEach(btn => {
    btn.onclick = () => fecharModal(btn.dataset.modal);
});

document.getElementById('exam-select').onchange = mudarExame;
document.getElementById('tab-prova').onclick = () => carregarPDF('prova');
document.getElementById('tab-gabarito').onclick = () => carregarPDF('gabarito');
document.getElementById('tab-vade').onclick = () => carregarPDF('vade');

// Escuta cliques no checklist (delega√ß√£o de evento)
document.getElementById('checklist-fgv').addEventListener('change', (e) => {
    if(e.target.classList.contains('chk-nota')) atualizarNota();
});

// --- SETUP INICIAL ---
const sel = document.getElementById('exam-select');
[44, 41, 40, 35].forEach(ex => { 
    let o = document.createElement('option'); o.value=ex; o.innerText=`EXAME ${ex}`; 
    if(ex==44) o.selected = true;
    sel.appendChild(o); 
});

document.getElementById('ln-main').innerHTML = Array.from({length:350}, (_,i)=>i+1).join('<br>');
document.getElementById('ln-res').innerHTML = Array.from({length:100}, (_,i)=>i+1).join('<br>');
document.getElementById('ln-dicas').innerHTML = Array.from({length:100}, (_,i)=>i+1).join('<br>');

mudarExame();
</script>
</body>
</html>
