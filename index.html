<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOAQUIM PRO - AMBIENTE DE ALTA PERFORMANCE</title>
    <style>
        :root { 
            --primary: #1a252f; --accent: #3498db; --bg: #f8f9fa; 
            --green: #27ae60; --red: #e74c3c; --header-h: 55px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        header { background: var(--primary); color: white; height: var(--header-h); padding: 0 20px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .timer { font-family: 'Courier New', monospace; color: #f1c40f; font-size: 1.2rem; font-weight: bold; }

        /* LAYOUT DIN√ÇMICO */
        main { display: flex; flex: 1; overflow: hidden; transition: 0.5s; }

        /* EDITOR (CENTRAL) */
        .editor-box { flex: 1.2; display: flex; flex-direction: column; background: white; border-right: 1px solid #ddd; transition: 0.3s; position: relative; }
        .toolbar { background: #f1f1f1; padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; }
        
        .paper { flex: 1; display: flex; overflow-y: auto; background: #fff; }
        .lines { width: 40px; background: #f8f9fa; border-right: 1px solid #ddd; padding-top: 30px; text-align: center; color: #bbb; font-size: 13px; line-height: 25px; }
        #area-peca { 
            flex: 1; padding: 30px; border: none; outline: none; resize: none;
            font-family: 'Times New Roman', serif; font-size: 18px; line-height: 25px;
            background-image: linear-gradient(#eef1f5 1px, transparent 1px);
            background-size: 100% 25px; background-attachment: local;
        }

        /* PAINEL DE APOIO (DIREITA) */
        .support-box { flex: 0.8; display: flex; flex-direction: column; background: #525659; transition: 0.3s; }
        .tabs { display: flex; background: #333; padding: 5px 5px 0; gap: 2px; }
        .tab { background: #444; color: #aaa; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px 5px 0 0; font-size: 0.7rem; font-weight: bold; }
        .tab.active { background: white; color: #333; }
        .view-container { flex: 1; background: white; position: relative; }
        iframe { width: 100%; height: 100%; border: none; display: none; }
        iframe.active { display: block; }

        /* SIMULADOR DE NOTA (FLUTUANTE NO GABARITO) */
        .calc-panel { position: absolute; bottom: 20px; right: 20px; width: 220px; background: var(--primary); color: white; padding: 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); display: none; z-index: 10; }
        .calc-panel.active { display: block; }
        .score-big { font-size: 2rem; color: var(--green); text-align: center; font-weight: bold; margin-bottom: 10px; }
        .check-item { display: flex; align-items: center; gap: 8px; font-size: 0.75rem; margin-bottom: 5px; cursor: pointer; }

        /* BOTOES */
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.75rem; transition: 0.2s; }
        .btn-focus { background: var(--accent); color: white; }
        .btn-eval { background: #9b59b6; color: white; }
        .btn-save { background: var(--green); color: white; }

        /* MODAL */
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .modal-card { background: white; padding: 30px; border-radius: 10px; width: 400px; }
        .ex-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; font-weight: bold; }
        .ex-item:hover { color: var(--accent); background: #f9f9f9; }

        /* RESPONSIVO */
        @media (max-width: 1024px) {
            main { flex-direction: column; }
            .support-box { height: 40%; }
        }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:15px;">
        <div class="timer" id="timer">05:00:00</div>
    </div>
    <div style="display:flex; gap:10px;">
        <button class="btn btn-focus" onclick="toggleFocus()">üëÅÔ∏è FOCO NO TEXTO</button>
        <button class="btn btn-eval" onclick="toggleEval()">‚öñÔ∏è MODO AVALIA√á√ÉO</button>
        <button class="btn btn-save" onclick="salvar()">üíæ SALVAR</button>
    </div>
</header>

<main id="main-layout">
    <section class="editor-box" id="editor-box">
        <div class="toolbar">
            <span id="exame-title" style="font-weight:bold; color:var(--accent); font-size:0.8rem;">Selecione um Exame</span>
            <span id="line-info" style="font-size:0.7rem; color:#888;">Linha: 1 / 150</span>
        </div>
        <div class="paper">
            <div class="lines" id="line-helper"></div>
            <textarea id="area-peca" oninput="sync()" spellcheck="false" placeholder="Escreva sua pe√ßa aqui..."></textarea>
        </div>
    </section>

    <section class="support-box" id="support-box">
        <div class="tabs">
            <button class="tab active" id="tab-enu" onclick="setTab('enu')">üìÑ ENUNCIADO</button>
            <button class="tab" id="tab-gab" onclick="setTab('gab')">‚öñÔ∏è GABARITO FGV</button>
        </div>
        <div class="view-container">
            <iframe id="frame-enu" class="active"></iframe>
            <iframe id="frame-gab"></iframe>
            
            <div class="calc-panel" id="calc">
                <div style="font-size:0.6rem; text-transform:uppercase; margin-bottom:5px;">Nota Estimada:</div>
                <div class="score-big" id="total-score">0.00</div>
                <label class="check-item"><input type="checkbox" class="ck" data-p="0.5" onchange="score()"> Endere√ßamento (+0.5)</label>
                <label class="check-item"><input type="checkbox" class="ck" data-p="1.0" onchange="score()"> Qualifica√ß√£o/Fatos (+1.0)</label>
                <label class="check-item"><input type="checkbox" class="ck" data-p="2.5" onchange="score()"> Teses Jur√≠dicas (+2.5)</label>
                <label class="check-item"><input type="checkbox" class="ck" data-p="1.0" onchange="score()"> Pedidos/Fechamento (+1.0)</label>
                <button class="btn" style="width:100%; margin-top:10px; background:#34495e; color:white;" onclick="toggleEval()">CONCLUIR</button>
            </div>
        </div>
    </section>
</main>

<div id="modal">
    <div class="modal-card">
        <h3 style="margin-bottom:20px; border-bottom:2px solid var(--accent);">Simulador OAB 2¬™ Fase</h3>
        <div id="lista-exames"></div>
    </div>
</div>

<script>
    // Setup Inicial
    const lineHelper = document.getElementById('line-helper');
    for (let i = 1; i <= 150; i++) lineHelper.innerHTML += i + '<br>';

    function setTab(type) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('iframe').forEach(f => f.classList.remove('active'));
        document.getElementById('tab-' + type).classList.add('active');
        document.getElementById('frame-' + type).classList.add('active');
        // Se mudar para o gabarito, sugere abrir o calculador
        if(type === 'gab' && document.getElementById('calc').style.display !== 'block') {
            document.getElementById('calc').classList.add('active');
        }
    }

    function toggleFocus() {
        const support = document.getElementById('support-box');
        support.style.display = support.style.display === 'none' ? 'flex' : 'none';
    }

    function toggleEval() {
        const calc = document.getElementById('calc');
        calc.classList.toggle('active');
        setTab('gab');
        // Ajusta propor√ß√£o para compara√ß√£o
        const editor = document.getElementById('editor-box');
        const support = document.getElementById('support-box');
        if(calc.classList.contains('active')) {
            editor.style.flex = "1";
            support.style.flex = "1";
        } else {
            editor.style.flex = "1.2";
            support.style.flex = "0.8";
        }
    }

    function carregar(num) {
        const ts = new Date().getTime();
        document.getElementById('frame-enu').src = `./ro${num}.pdf?v=${ts}`;
        document.getElementById('frame-gab').src = `./ro${num}-gabarito.pdf?v=${ts}`;
        document.getElementById('exame-title').innerText = `OAB EXAME XXX${num}`;
        document.getElementById('modal').style.display = 'none';
        
        const salvo = localStorage.getItem('peca_oab_' + num);
        if(salvo) {
            document.getElementById('area-peca').value = salvo;
            sync();
        }
    }

    function sync() {
        const val = document.getElementById('area-peca').value;
        const lines = val.split('\n').length;
        document.getElementById('line-info').innerText = `Linha: ${lines} / 150`;
        document.getElementById('line-info').style.color = lines > 150 ? 'red' : '#888';
    }

    function score() {
        let s = 0;
        document.querySelectorAll('.ck:checked').forEach(c => s += parseFloat(c.dataset.p));
        document.getElementById('total-score').innerText = s.toFixed(2);
    }

    function salvar() {
        const num = document.getElementById('exame-title').innerText.match(/\d+/);
        if(!num) return;
        localStorage.setItem('peca_oab_' + num[0], document.getElementById('area-peca').value);
        alert("Rascunho salvo com sucesso!");
    }

    // Modal Builder
    const lista = document.getElementById('lista-exames');
    for (let i = 35; i <= 45; i++) {
        lista.innerHTML += `<div class="ex-item" onclick="carregar('${i}')">PROVA OAB XXX${i}</div>`;
    }

    // Timer
    let t = 18000;
    setInterval(() => {
        if(t <= 0) return; t--;
        let h = Math.floor(t/3600), m = Math.floor((t%3600)/60), s = t%60;
        document.getElementById('timer').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }, 1000);
</script>
</body>
</html>
