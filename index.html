<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ARYANNA MASTER PRO | 2026</title>
    
    <link rel="stylesheet" href="estilos.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Courier+Prime&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
</head>
<body class="dark-mode">

<header>
    <div class="logo">ARYANNA MASTER 2026</div>
    <div id="timer-display">05:00:00</div>
</header>

<div class="main-container">
    <section class="editor-section">
        <div class="toolbar">
            <select id="exam-select" class="btn-symbol" style="width:auto; font-size:0.75rem; font-weight:bold;">
                <option value="44">EXAME 44</option>
                <option value="43">EXAME 43</option>
                <option value="42">EXAME 42</option>
                <option value="41">EXAME 41</option>
                <option value="40">EXAME 40</option>
                <option value="39">EXAME 39</option>
                <option value="38">EXAME 38</option>
                <option value="37">EXAME 37</option>
                <option value="36">EXAME 36</option>
                <option value="35" selected>EXAME 35</option>
            </select>
            
            <button class="btn-symbol" onclick="location.href='mentoria.html'">üèÜ</button>
            <button class="btn-symbol" title="Quest√µes" id="btn-questoes">üìö</button>
            <button class="btn-symbol" title="Estruturas" id="btn-balanca">‚öñÔ∏è</button>
            <button class="btn-symbol" title="Espelho" id="btn-espelho">üéØ</button>
            <button class="btn-symbol" title="Calculadora" id="btn-prazos">üìÖ</button>
            <button class="btn-symbol" title="Post-its" id="btn-nc">üìå</button>
            <button class="btn-symbol" id="btn-limpar">üóëÔ∏è</button>
            <button class="btn-symbol" id="btn-tema">üåì</button>
            <button class="btn-symbol" id="btn-salvar" style="background:var(--success); color:white; margin-left:auto;">üíæ</button>
        </div>
        
        <div class="paper-wrapper">
            <div class="paper-sheet">
                <div class="line-nums" id="ln-main"></div>
                <textarea id="texto-final" class="text-area" spellcheck="false" placeholder="Inicie sua pe√ßa..."></textarea>
            </div>
        </div>
    </section>

    <section class="viewer-section" id="section-pdf">
        <div class="tabs">
            <button class="tab active" data-type="prova">PROVA</button>
            <button class="tab" data-type="gabarito">GABARITO</button>
            <button class="tab" data-type="espelho">ESPELHO</button>
            <button class="tab" data-type="vade">VADE</button>
        </div>
        <div id="pdf-viewport"></div>
    </section>
</div>

<button class="floating-toggle" id="mobile-switch">‚áÑ</button>

<div id="menu-estruturas" class="modal-context"></div>

<div id="modal-geral" class="modal-full">
    <div class="modal-header">
        <button class="btn-back" id="close-modal">‚Üê VOLTAR</button>
        <h3 id="modal-titulo">T√çTULO</h3>
    </div>
    <div class="modal-body" id="modal-conteudo"></div>
</div>

<script type="module">
    import { ESTRUTURAS } from './estruturas.js';
    import { BANCO_ESPELHOS } from './banco-espelhos.js';
    import { loadPDF } from './pdf-engine.js';
    import { initDatabase } from './firebase-config.js';

    // 1. Inicializa PDF Engine
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    // 2. Fun√ß√µes de Controle de PDF
    const updatePDF = (tipo = 'prova') => {
        const ex = document.getElementById('exam-select').value;
        let file = '';
        if (tipo === 'prova') file = `ro${ex}.pdf`;
        else if (tipo === 'gabarito') file = `ro${ex}-gabarito.pdf`;
        else if (tipo === 'espelho') file = `ro${ex}-espelho.pdf`;
        else file = `vade.pdf`;
        
        loadPDF(file); // Chama a intelig√™ncia do seu pdf-engine.js
    };

    // 3. Eventos de UI
    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = (e) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            e.target.classList.add('active');
            updatePDF(e.target.dataset.type);
        };
    });

    // 4. Inje√ß√£o da Balan√ßa ‚öñÔ∏è (Estruturas.js)
    document.getElementById('btn-balanca').onclick = () => {
        const menu = document.getElementById('menu-estruturas');
        const ex = document.getElementById('exam-select').value;
        const dados = ESTRUTURAS[ex] || ESTRUTURAS["RT"];
        
        menu.innerHTML = `
            <div style="padding:15px; border-bottom:1px solid #ddd; font-weight:bold;">${dados.nome_peca || 'PE√áA T√âCNICA'}</div>
            <div class="menu-item" id="inject-action" style="color:blue; padding:15px; cursor:pointer;">INJETAR ESTRUTURA COMPLETA</div>
        `;
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        
        document.getElementById('inject-action').onclick = () => {
            document.getElementById('texto-final').value = dados.esqueleto || dados;
            menu.style.display = 'none';
        };
    };

    // 5. Linhas e Inicializa√ß√£o
    document.getElementById('ln-main').innerHTML = Array.from({length:350}, (_,i)=>i+1).join('<br>');
    document.getElementById('exam-select').onchange = () => updatePDF('prova');
    
    // In√≠cio imediato
    updatePDF('prova');
</script>

</body>
</html>
