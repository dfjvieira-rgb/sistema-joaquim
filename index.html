<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HOME - JOAQUIM ELITE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-paper: #cbd5e1; --paper-color: #ffffff; --line-color: #d1d5db;
            --text-color: #1e293b; --margem-cor: #f87171; --gold: #fbbf24;
            --primary: #0f172a; --sidebar-w: 65px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg-paper); display: flex; height: 100dvh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: var(--sidebar-w); background: var(--primary); display: flex; flex-direction: column; gap: 10px; padding: 10px; z-index: 100; flex-shrink: 0; }
        .btn-side { width: 100%; height: 45px; border-radius: 8px; border: none; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }

        /* VIEWPORT (O segredo para não cortar) */
        .viewport { flex: 1; overflow: auto; padding: 15px; display: flex; justify-content: flex-start; -webkit-overflow-scrolling: touch; }

        .paper { 
            background: var(--paper-color); width: 850px; /* Mantém largura real OAB */
            min-height: fit-content; display: flex; position: relative;
            box-shadow: 0 0 15px rgba(0,0,0,0.2); flex-shrink: 0;
        }

        /* RÉGUA */
        .regua { width: 45px; background: #f8fafc; border-right: 1px solid var(--line-color); flex-shrink: 0; padding-top: 50px; }
        .regua-num, .regua-espaco { height: 35px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #94a3b8; }

        .conteudo { flex: 1; position: relative; }
        .margem-vermelha { position: absolute; top: 0; right: 60px; width: 1px; height: 100%; background: var(--margem-cor); opacity: 0.4; pointer-events: none; }

        /* TABELA */
        .grid-oab { width: 100%; border-collapse: collapse; table-layout: fixed; }
        .grid-oab td { 
            height: 35px; border-bottom: 1px solid var(--line-color);
            padding: 0 75px 0 15px; font-family: 'Courier New', monospace; 
            font-size: 18px; color: var(--text-color); outline: none;
            overflow: hidden; white-space: nowrap; /* Trava o texto na linha */
        }

        /* DIVISÓRIAS */
        .divisoria-box { background: var(--primary); color: var(--gold); font-weight: bold; font-size: 0.7rem; text-align: center; height: 30px !important; }
        .item-box { background: #f8fafc; color: #64748b; font-size: 0.6rem; height: 25px !important; font-weight: bold; padding-left: 15px !important; }
        
        #identificador { padding: 15px; text-align: center; font-weight: 900; border-bottom: 1px solid var(--line-color); }
    </style>
</head>
<body>

    <aside class="sidebar">
        <button class="btn-side" style="background:#3b82f6;" onclick="window.injetarJustica()"><i class="fas fa-bolt"></i></button>
        <button class="btn-side" style="background:#6366f1;" onclick="window.irPara(1)">P</button>
        <button class="btn-side" style="background:#6366f1;" onclick="window.irPara(51)">Q1</button>
        <button class="btn-side" style="background:#6366f1;" onclick="window.irPara(81)">Q2</button>
    </aside>

    <div class="viewport">
        <div class="paper">
            <div class="regua" id="REGUA"></div>
            <div class="conteudo">
                <div class="margem-vermelha"></div>
                <div id="identificador">CADERNO DE RESPOSTAS FGV</div>
                <table class="grid-oab">
                    <tbody id="FOLHA" contenteditable="true" spellcheck="false"></tbody>
                </table>
            </div>
        </div>
    </div>

<script type="module">
    import { RadarElite } from './modulo-radar.js';
    import { BANCO_ESPELHOS } from './banco-espelhos.js';

    let ultimaLinha = 1;

    const gerarFolha = () => {
        const folha = document.getElementById('FOLHA');
        const regua = document.getElementById('REGUA');
        
        for (let i = 1; i <= 180; i++) {
            // Títulos Seção (Injetados para organização)
            if (i === 1) criarTitulo(folha, regua, "PEÇA PROFISSIONAL", "divisoria-box");
            if (i === 51) { criarTitulo(folha, regua, "QUESTÃO 1", "divisoria-box"); criarTitulo(folha, regua, "ITENS A e B", "item-box"); }
            if (i === 81) { criarTitulo(folha, regua, "QUESTÃO 2", "divisoria-box"); criarTitulo(folha, regua, "ITENS A e B", "item-box"); }
            if (i === 111) { criarTitulo(folha, regua, "QUESTÃO 3", "divisoria-box"); criarTitulo(folha, regua, "ITENS A e B", "item-box"); }
            if (i === 141) { criarTitulo(folha, regua, "QUESTÃO 4", "divisoria-box"); criarTitulo(folha, regua, "ITENS A e B", "item-box"); }

            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.id = `L${i}`;
            td.onfocus = () => ultimaLinha = i;
            tr.appendChild(td);
            folha.appendChild(tr);

            const num = document.createElement('div');
            num.className = "regua-num";
            num.innerText = i;
            regua.appendChild(num);
        }
    };

    const criarTitulo = (folha, regua, texto, classe) => {
        const tr = document.createElement('tr');
        tr.contentEditable = "false";
        const td = document.createElement('td');
        td.className = classe; td.innerText = texto;
        tr.appendChild(td);
        folha.appendChild(tr);

        const espaco = document.createElement('div');
        espaco.className = "regua-espaco";
        espaco.style.height = (classe === "divisoria-box" ? "30px" : "25px");
        regua.appendChild(espaco);
    };

    window.injetarJustica = () => {
        const ex = localStorage.getItem('activeEx') || "44";
        const dna = BANCO_ESPELHOS[ex] || "";
        const analise = RadarElite.analisarGabarito(dna);
        const frases = RadarElite.prepararLinhas(dna);
        
        let alvo = analise.questao ? analise.questao.linhaAlvo : ultimaLinha;

        frases.forEach((txt, index) => {
            const linha = document.getElementById(`L${alvo + index}`);
            if (linha) linha.innerText = txt;
        });
        window.irPara(alvo);
    };

    window.irPara = (n) => {
        const el = document.getElementById(`L${n}`);
        if(el) { el.scrollIntoView({behavior: "smooth", block: "center"}); el.focus(); }
    };

    window.onload = gerarFolha;
</script>
</body>
</html>
