<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA JOAQUIM - MENTORIA V4.5</title>
    <style>
        :root { 
            --primary: #0f172a; --accent: #3b82f6; --bg: #f1f5f9; 
            --sidebar-bg: #1e293b; --law-green: #059669; --tst-blue: #2563eb; 
            --cf-purple: #9333ea; --paper: #ffffff;
        }
        
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: #1e293b; }
        
        header { 
            background: var(--primary); color: white; padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent);
        }
        .timer-box { background: #334155; padding: 5px 15px; border-radius: 20px; font-family: monospace; font-size: 1.1rem; color: #fbbf24; border: 1px solid #475569; }

        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        #main-app { display: none; }

        .main-layout { display: flex; flex-direction: column; min-height: 100vh; }
        @media (min-width: 768px) { .main-layout { flex-direction: row; } .sidebar { width: 260px; height: 100vh; position: sticky; top: 50px; } }
        
        .sidebar { background: var(--sidebar-bg); color: white; padding: 15px; overflow-y: auto; }
        .nav-btn { width: 100%; text-align: left; padding: 12px; margin-bottom: 6px; border: none; background: rgba(255,255,255,0.05); color: #cbd5e1; cursor: pointer; border-radius: 8px; font-size: 0.8rem; }
        .nav-btn.active { background: var(--accent); color: white; font-weight: bold; }

        .content-area { padding: 20px; flex-grow: 1; max-width: 1000px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        #joaquim { 
            background: var(--paper); padding: 40px; border-radius: 4px; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); min-height: 80vh; 
            border: 1px solid #e2e8f0; 
        }

        .gabarito-panel { background: #f8fafc; border: 1px solid #cbd5e1; padding: 15px; border-radius: 12px; margin-bottom: 25px; }
        .gab-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .gab-btn { background: #64748b; color: white; border: none; padding: 10px; border-radius: 6px; font-weight: bold; font-size: 0.75rem; cursor: pointer; }
        
        .guia-btn { width: 100%; background: var(--law-green); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 10px; text-transform: uppercase; }
        
        .gab-content, #texto-final { 
            margin-top: 20px; padding: 30px; 
            background: #fff; border: 1px solid #e2e8f0; border-radius: 4px;
            font-family: 'Times New Roman', serif; font-size: 1.25rem;
            line-height: 1.8; color: #000; text-align: justify;
            white-space: pre-wrap;
        }

        /* Recuo de par√°grafo preservado */
        .gab-paragraph, .user-paragraph {
            text-indent: 3em; 
            margin-bottom: 0.6em;
            display: block;
        }

        .guia-content { 
            display: none; margin-top: 15px; padding: 20px; 
            background: #f0fdf4; border-radius: 8px; border-left: 5px solid var(--law-green); 
            max-height: 400px; overflow-y: auto;
        }
        
        .planalto-tools { margin-top: 15px; padding: 12px; background: #fff; border-radius: 8px; border: 1px dashed #cbd5e1; }
        .btn-planalto { color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 0.7rem; margin: 3px; font-weight: 600; }
        
        #texto-final { outline: none; min-height: 600px; border-top: 4px solid var(--accent); }
        .copy-btn { width: 100%; margin-bottom: 20px; background: var(--accent); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="login-screen">
    <button onclick="liberar()" style="padding:20px 50px; cursor:pointer; font-weight:bold; border-radius:50px; border:none; background:var(--accent); color:white; font-size: 1.3rem;">INICIAR SIMULADO</button>
</div>

<div id="main-app">
    <header>
        <div>JOAQUIM <span style="font-weight:200; opacity:0.7;">| 2¬™ FASE OAB</span></div>
        <div class="timer-box" id="cronometro">00:00:00</div>
    </header>
    
    <div class="main-layout">
        <nav class="sidebar" id="menuLateral"></nav>
        <main class="content-area">
            <div id="joaquim"></div>
        </main>
    </div>
</div>

<script src="gabaritos.js"></script>

<script>
    // LISTA COMPLETA RECUPERADA
    const nomesPecas = { 
        rt: "01. Reclama√ß√£o Trabalhista", 
        consigna: "02. Consigna√ß√£o em Pagamento", 
        inquerito: "03. Inqu√©rito Falta Grave", 
        cont: "04. Contesta√ß√£o", 
        ed: "05. Embargos de Declara√ß√£o", 
        replica: "06. R√©plica", 
        ro: "07. Recurso Ordin√°rio", 
        rade: "08. Recurso Adesivo", 
        ai: "09. Agravo de Instrumento", 
        rr: "10. Recurso de Revista", 
        emb_tst: "11. Embargos ao TST", 
        re_stf: "12. Recurso Extraordin√°rio", 
        emb_exec: "13. Embargos √† Execu√ß√£o", 
        epe: "14. Exce√ß√£o de Pr√©-Executividade", 
        ap: "15. Agravo de Peti√ß√£o", 
        emb_terc: "16. Embargos de Terceiro", 
        ms: "17. Mandado de Seguran√ßa", 
        ar: "18. A√ß√£o Rescis√≥ria" 
    };
    
    let pecaAtiva = 'ro';
    let segundos = 0;

    function liberar() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        montarMenu(); 
        loadPeca('ro'); // Inicia no RO do Jos√© Jaime como solicitado
        setInterval(() => {
            segundos++;
            const h = Math.floor(segundos / 3600).toString().padStart(2, '0');
            const m = Math.floor((segundos % 3600) / 60).toString().padStart(2, '0');
            const s = (segundos % 60).toString().padStart(2, '0');
            document.getElementById('cronometro').innerText = `${h}:${m}:${s}`;
        }, 1000);
    }

    function montarMenu() {
        document.getElementById('menuLateral').innerHTML = Object.keys(nomesPecas).map(k => 
            `<button class="nav-btn" id="btn_${k}" onclick="loadPeca('${k}')">${nomesPecas[k]}</button>`
        ).join('');
    }

    function linkDirecionado(termo) {
        const t = termo.trim().toUpperCase();
        let query = (t.includes("S√öMULA") || t.includes("OJ")) ? `site:tst.jus.br jurisprudencia ${termo}` : `site:planalto.gov.br "Decreto-Lei 5452" ${termo}`;
        window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
    }

    function formatarParagrafos(texto, classe) {
        if(!texto) return "";
        return texto.split('\n').map(linha => {
            if (linha.trim().length === 0) return '<br>';
            if (linha.length < 65 && !linha.includes('.')) return `<div><strong>${linha}</strong></div>`;
            return `<div class="${classe}">${linha}</div>`;
        }).join('');
    }

    function rastrearFundamentos() {
        const txtUser = document.getElementById('texto-final')?.innerText || "";
        const txtGuia = document.getElementById('view_guia_area')?.innerText || "";
        const total = txtUser + " " + txtGuia;
        const regex = /(Art\.?|S√∫mula|Sumula|OJ|CF|CPC)\s?\d+([-]?[A-Z0-9])?/gi;
        const matches = [...new Set(total.match(regex) || [])];
        const container = document.getElementById('container-rastreio');
        if (container) {
            container.innerHTML = matches.map(m => {
                let cor = 'var(--law-green)';
                if (/S√∫mula|Sumula|OJ/i.test(m)) cor = 'var(--tst-blue)';
                if (/CF/i.test(m)) cor = 'var(--cf-purple)';
                return `<button class="btn-planalto" style="background:${cor}" onclick="linkDirecionado('${m}')">üîé ${m}</button>`;
            }).join('') || '...';
        }
    }

    function loadPeca(key) {
        pecaAtiva = key;
        const db = window.dbGabaritosExternos || {};
        const dadosPeca = db[key] || {};
        
        let botoesGab = '';
        Object.keys(dadosPeca).forEach(n => {
            if(!isNaN(n)) botoesGab += `<button class="gab-btn" onclick="toggleVis('gab_${n}')">üìñ Gabarito ${n}</button>`;
        });

        const guiaTexto = dadosPeca.guia || "Fundamenta√ß√£o n√£o encontrada no arquivo gabaritos.js";

        document.getElementById('joaquim').innerHTML = `
            <button class="copy-btn" onclick="copyText()">FINALIZAR E COPIAR PE√áA</button>
            <div class="gabarito-panel">
                <div class="gab-grid">${botoesGab}</div>
                <button class="guia-btn" onclick="toggleVis('guia_content')">üí° FUNDAMENTA√á√ÉO E GUIA</button>
                <div id="guia_content" class="guia-content">
                    <div id="view_guia_area" style="white-space:pre-wrap;">${guiaTexto}</div>
                    <div class="planalto-tools"><div id="container-rastreio"></div></div>
                </div>
                ${Object.keys(dadosPeca).filter(n => !isNaN(n)).map(n => 
                    `<div id="gab_${n}" class="gab-content" style="display:none">${formatarParagrafos(dadosPeca[n], 'gab-paragraph')}</div>`
                ).join('')}
            </div>
            <div id="texto-final" contenteditable="true" oninput="rastrearFundamentos()" spellcheck="false">ID: 936045\n\nAO DOUTO JU√çZO...</div>
        `;
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn_' + key)?.classList.add('active');
        rastrearFundamentos();
    }

    function toggleVis(id) {
        const el = document.getElementById(id);
        const isVis = el.style.display === 'block';
        document.querySelectorAll('.gab-content, .guia-content').forEach(d => d.style.display = 'none');
        if (el) el.style.display = isVis ? 'none' : 'block';
        rastrearFundamentos();
    }

    function copyText() {
        const el = document.getElementById('texto-final');
        const range = document.createRange(); range.selectNode(el);
        window.getSelection().removeAllRanges(); window.getSelection().addRange(range);
        document.execCommand('copy'); alert("Pe√ßa copiada!");
    }
</script>
</body>
</html>
