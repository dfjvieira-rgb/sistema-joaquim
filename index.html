<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JOAQUIM ELITE 2026 - HOME</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-paper: #cbd5e1; --paper-color: #ffffff; --line-color: #d1d5db;
            --text-color: #1e293b; --margem-cor: #f87171; --gold: #fbbf24;
            --primary: #0f172a; --sidebar-w: 70px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background: var(--bg-paper); 
            font-family: 'Inter', sans-serif; 
            display: flex; 
            height: 100dvh; 
            overflow: hidden; 
        }

        /* SIDEBAR FIXA */
        .sidebar { 
            width: var(--sidebar-w); 
            background: var(--primary); 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            padding: 10px; 
            z-index: 100;
            flex-shrink: 0;
        }
        
        .btn-side { 
            width: 100%; height: 45px; border-radius: 8px; border: none; 
            cursor: pointer; color: white; display: flex; align-items: center; 
            justify-content: center; font-size: 1.1rem; transition: 0.2s;
        }
        .btn-side:active { transform: scale(0.95); opacity: 0.8; }

        /* VIEWPORT (O segredo para não cortar no mobile) */
        .viewport { 
            flex: 1; 
            overflow: auto; /* Permite scroll horizontal e vertical */
            display: flex; 
            justify-content: flex-start; 
            padding: 20px; 
            -webkit-overflow-scrolling: touch;
        }

        .paper { 
            background: var(--paper-color); 
            width: 850px; /* Mantém a largura real da folha OAB */
            min-height: fit-content;
            display: flex; 
            box-shadow: 0 0 20px rgba(0,0,0,0.15);
            position: relative;
            flex-shrink: 0; /* Impede o navegador de achatar a folha */
        }

        /* RÉGUA LATERAL */
        .regua { 
            width: 45px; 
            background: #f8fafc; 
            border-right: 1px solid var(--line-color);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        .regua-num, .regua-espaco { 
            height: 35px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 0.7rem; 
            color: #94a3b8;
        }

        /* ÁREA DE TEXTO */
        .conteudo { flex: 1; position: relative; }
        
        .margem-vermelha { 
            position: absolute; top: 0; right: 60px; 
            width: 1px; height: 100%; 
            background: var(--margem-cor); opacity: 0.5; 
            pointer-events: none; 
        }

        .grid-oab { width: 100%; border-collapse: collapse; table-layout: fixed; }
        
        .grid-oab td { 
            height: 35px; 
            border-bottom: 1px solid var(--line-color);
            padding: 0 70px 0 15px; 
            font-family: 'Courier New', monospace; 
            font-size: 18px; 
            color: var(--text-color);
            outline: none;
            vertical-align: middle;
            /* Proteção contra quebras que desalinhariam a régua */
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: clip;
        }

        /* CABEÇALHOS ESTILO OAB */
        .divisoria-box { 
            background: var(--primary); color: var(--gold); 
            font-weight: bold; font-size: 0.7rem; text-align: center; 
            height: 30px !important; padding: 0 !important;
            text-transform: uppercase;
        }
        
        .item-box { 
            background: #f8fafc; color: #64748b; 
            font-size: 0.6rem; height: 25px !important; 
            font-weight: bold; padding-left: 15px !important;
        }

    </style>
</head>
<body>

    <aside class="sidebar">
        <button class="btn-side" style="background:var(--gold); color:#000" onclick="alert('Escolher Exame')"><i class="fas fa-list"></i></button>
        <button class="btn-side" style="background:#3b82f6;" onclick="window.injetarJustica()"><i class="fas fa-bolt"></i></button>
        <button class="btn-side" style="background:#ef4444;" onclick="location.reload()"><i class="fas fa-trash"></i></button>
        <button class="btn-side" style="background:#6366f1;" onclick="window.irPara(1)">P</button>
        <button class="btn-side" style="background:#6366f1;" onclick="window.irPara(51)">Q</button>
    </aside>

    <div class="viewport">
        <div class="paper">
            <div class="regua" id="REGUA"></div>
            <div class="conteudo">
                <div class="margem-vermelha"></div>
                <table class="grid-oab">
                    <tbody id="FOLHA" contenteditable="true" spellcheck="false"></tbody>
                </table>
            </div>
        </div>
    </div>

<script type="module">
    import { RadarElite } from './modulo-radar.js';
    import { BANCO_ESPELHOS } from './banco-espelhos.js';

    let ultimaLinhaFocada = 1;

    // Função que gera as 190 linhas e organiza as seções
    const inicializarFolha = () => {
        const folha = document.getElementById('FOLHA');
        const regua = document.getElementById('REGUA');
        
        for (let i = 1; i <= 180; i++) {
            // Injeção dos cabeçalhos oficiais da FGV
            if (i === 1) criarTitulo(folha, regua, "PEÇA PROFISSIONAL", "divisoria-box");
            
            // Questões 1 a 4 automáticas
            if ([51, 81, 111, 141].includes(i)) {
                const nQuestao = (i === 51) ? 1 : (i === 81) ? 2 : (i === 111) ? 3 : 4;
                criarTitulo(folha, regua, `QUESTÃO ${nQuestao}`, "divisoria-box");
                criarTitulo(folha, regua, "ITENS A e B", "item-box");
            }

            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.id = `L${i}`;
            td.onfocus = () => ultimaLinhaFocada = i;
            tr.appendChild(td);
            folha.appendChild(tr);

            const num = document.createElement('div');
            num.className = "regua-num";
            num.innerText = i;
            regua.appendChild(num);
        }
    };

    const criarTitulo = (folha, regua, texto, classe) => {
        const tr = document.createElement('tr');
        tr.contentEditable = "false";
        const td = document.createElement('td');
        td.className = classe;
        td.innerText = texto;
        tr.appendChild(td);
        folha.appendChild(tr);

        // Compensa a altura exata do cabeçalho na régua lateral
        const espaco = document.createElement('div');
        espaco.className = "regua-espaco";
        espaco.style.height = (classe === "divisoria-box" ? "30px" : "25px");
        regua.appendChild(espaco);
    };

    window.injetarJustica = () => {
        const exAtivo = localStorage.getItem('activeEx') || "44";
        const dna = BANCO_ESPELHOS[exAtivo] || "";
        
        // O RadarElite analisa o gabarito
        const analise = RadarElite.analisarGabarito(dna);
        const frases = RadarElite.prepararLinhas(dna);
        
        // Define o ponto de partida (Questão ou onde o usuário clicou)
        let alvo = analise.questao ? analise.questao.linhaAlvo : ultimaLinhaFocada;

        frases.forEach((txt, index) => {
            const celula = document.getElementById(`L${alvo + index}`);
            if (celula) celula.innerText = txt;
        });

        window.irPara(alvo);
    };

    window.irPara = (n) => {
        const el = document.getElementById(`L${n}`);
        if(el) {
            el.scrollIntoView({ behavior: "smooth", block: "center" });
            el.focus();
        }
    };

    window.onload = inicializarFolha;
    window.injetarJustica = window.injetarJustica;
    window.irPara = window.irPara;
</script>
</body>
</html>
