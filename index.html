window.loadPDF = async (tipo, btn) => {
    if(btn) { 
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); 
        btn.classList.add('active'); 
    }
    const ex = document.getElementById('exam-select').value;
    const container = document.getElementById('pdf-viewport');
    container.innerHTML = `<p style="color:var(--gold); margin-top:20px;">Buscando PDF do Exame ${ex}...</p>`;
    
    // Tenta montar o nome do arquivo
    let filename = `exame${ex}.pdf`; 
    if(tipo === 'gabarito') filename = `exame${ex}-gabarito.pdf`;
    if(tipo === 'espelho') filename = `exame${ex}-espelho.pdf`;
    if(tipo === 'vade') filename = `vade.pdf`;

    try {
        const loadingTask = pdfjsLib.getDocument(filename);
        const pdf = await loadingTask.promise;
        container.innerHTML = '';
        for(let i=1; i<=pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({scale: 1.4});
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            await page.render({canvasContext: context, viewport: viewport}).promise;
            container.appendChild(canvas);
        }
    } catch(e) {
        container.innerHTML = `
            <div style="color:white; padding:40px; text-align:center; background:#1e293b; border-radius:10px; margin:20px;">
                <p style="font-size:3rem;">⚠️</p>
                <p style="color:var(--gold); font-weight:bold;">PDF NÃO ENCONTRADO</p>
                <p style="font-size:0.9rem; margin:10px 0;">Nome procurado: <span style="color:#f87171;">${filename}</span></p>
                <hr style="opacity:0.2; margin:15px 0;">
                <p style="font-size:0.8rem; text-align:left;"><b>Como resolver:</b><br>
                1. Renomeie o PDF da prova para <b>${filename}</b><br>
                2. Coloque-o na mesma pasta do index.html<br>
                3. Atualize a página (F5)</p>
            </div>`;
    }
};
