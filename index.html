<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ARYANNA 2026 | SIMULADOR 180 LINHAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #0f172a; --gold: #fbbf24; --purple: #a855f7; --border: #94a3b8; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: #e2e8f0; }

        header { 
            background: var(--primary); color: white; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
        }

        .nav-buttons { display: flex; gap: 10px; }
        
        /* Botões de Referência Estilizados */
        .btn-ref { 
            width: 45px; height: 45px; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; border: none; font-size: 1.2rem; transition: 0.3s;
        }
        .btn-ref:hover { transform: translateY(-3px); filter: brightness(1.2); }

        .folha-container { 
            max-width: 850px; margin: 20px auto; background: white; 
            padding: 40px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid var(--border);
        }

        .linha-texto { 
            width: 100%; border: none; border-bottom: 1px solid #cbd5e1; 
            line-height: 30px; font-size: 18px; font-family: 'Courier New', Courier, monospace;
            resize: none; outline: none; background: transparent; display: block;
        }

        .exame-selector { background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--gold); padding: 5px 10px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 800; font-size: 1.1rem; color: var(--gold);">ARYANNA 2026</div>
    
    <select id="exame-atual" class="exame-selector" onchange="trocarExame()">
        <option value="44">EXAME 44</option>
        <option value="43">EXAME 43</option>
        <option value="42">EXAME 42</option>
        <option value="41">EXAME 41</option>
    </select>

    <div class="nav-buttons">
        <button class="btn-ref" onclick="abrirConsultor()" style="background: var(--purple); color: white;" title="Consultor de Peças">
            <i class="fas fa-robot"></i>
        </button>

        <button class="btn-ref" onclick="irParaMentoria()" style="background: var(--gold); color: black;" title="Mentoria e Teses">
            <i class="fas fa-trophy"></i>
        </button>
    </div>
</header>

<main class="folha-container">
    <div style="text-align: center; font-weight: 800; margin-bottom: 20px; text-decoration: underline;">CADERNO DE RESPOSTA - PEÇA PROFISSIONAL</div>
    <textarea id="area-escrita" class="linha-texto" rows="30" placeholder="Comece sua peça aqui..."></textarea>
    
    <button onclick="finalizarESalvar()" style="margin-top: 20px; width: 100%; padding: 15px; background: #065f46; color: white; border: none; border-radius: 8px; font-weight: 800; cursor: pointer;">
        <i class="fas fa-save"></i> FINALIZAR E ARQUIVAR NO HISTÓRICO
    </button>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = { 
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", 
        authDomain: "masteroab-db5e1.firebaseapp.com", 
        projectId: "masteroab-db5e1", 
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" 
    };
    const app = initializeApp(config);
    const db = getDatabase(app);

    // Lógica para detectar se a Mentoria pediu para abrir um exame específico
    const urlParams = new URLSearchParams(window.location.search);
    const exameUrl = urlParams.get('exame');
    if(exameUrl) {
        document.getElementById('exame-atual').value = exameUrl;
    }

    // Carregar texto salvo automaticamente
    const carregarConteudo = () => {
        const exame = document.getElementById('exame-atual').value;
        onValue(ref(db, `estudos/${exame}`), (snap) => {
            if(snap.exists()) {
                document.getElementById('area-escrita').value = snap.val().texto;
            } else {
                document.getElementById('area-escrita').value = "";
            }
        });
    };

    // Salvar no histórico de simulados (O que aparece no Disquete da Mentoria)
    window.finalizarESalvar = () => {
        const exame = document.getElementById('exame-atual').value;
        const texto = document.getElementById('area-escrita').value;
        const dataAtual = new Date().toLocaleDateString('pt-BR');

        if(!texto) return alert("Escreva algo antes de salvar!");

        // Salva na pasta de treino
        set(ref(db, `estudos/${exame}`), { texto, data: dataAtual });

        // Salva no histórico da Mentoria (O Disquete)
        set(ref(db, `mentoria/historico/${exame}`), {
            exame: exame,
            data: dataAtual,
            preview: texto.substring(0, 100)
        }).then(() => {
            alert("Simulado arquivado com sucesso! Confira no seu histórico.");
        });
    };

    window.trocarExame = () => carregarConteudo();
    carregarConteudo();
</script>

<script>
    // Funções de Navegação
    function abrirConsultor() {
        // Abre a mentoria em nova aba focada no histórico (Consultor)
        window.open('mentoria.html?mode=consultor', '_blank');
    }

    function irParaMentoria() {
        // Vai para a mentoria na mesma aba (Fluxo de estudo)
        window.location.href = 'mentoria.html';
    }
</script>

</body>
</html>
