// --- NOVO RADAR AUTOMATIZADO (LÊ O BANCO E O TEXTO) ---
    const identificarPecaElite = () => {
        const sidebarStatus = document.getElementById('radar-status');
        const boxSidebar = document.getElementById('radar-container');
        const topoFolha = document.getElementById('identificador-peca');

        // 1. BEBE DO BANCO (Antecipação)
        const dnaEspelho = (BANCO_ESPELHOS[activeEx] || "").toUpperCase();
        
        // 2. BEBE DAS LINHAS (O que você digitou)
        const textoLinhas = Array.from(document.querySelectorAll('.linha-folha'))
                                 .map(input => input.value)
                                 .join(' ')
                                 .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                                 .toUpperCase();

        const DICIONARIO = [
            { id: "RECLAMACAO", display: "RECLAMATÓRIA TRABALHISTA", cor: "#a855f7", gatilhos: ["RECLAMACAO", "840"] },
            { id: "CONTESTACAO", display: "CONTESTAÇÃO TRABALHISTA", cor: "#22c55e", gatilhos: ["CONTESTACAO", "847"] },
            { id: "RECURSO ORDINARIO", display: "RECURSO ORDINÁRIO", cor: "#3b82f6", gatilhos: ["RECURSO ORDINARIO", "895"] },
            { id: "AGRAVO DE PETICAO", display: "AGRAVO DE PETIÇÃO", cor: "#f87171", gatilhos: ["AGRAVO DE PETICAO", "897"] },
            { id: "MANDADO DE SEGURANCA", display: "MANDADO DE SEGURANÇA", cor: "#06b6d4", gatilhos: ["SEGURANCA", "12016"] }
        ];

        // Busca primeiro no seu texto, se não achar, busca no espelho da FGV
        let achado = DICIONARIO.find(p => p.gatilhos.some(g => textoLinhas.includes(g))) || 
                     DICIONARIO.find(p => dnaEspelho.includes(p.id) || dnaEspelho.includes(p.gatilhos[1]));

        if (achado) {
            sidebarStatus.innerHTML = `<span style="color:${achado.cor}">RADAR: OK</span><br>${achado.id.replace('RECURSO ', 'REC. ')}`;
            boxSidebar.style.borderColor = achado.cor;
            boxSidebar.classList.remove('radar-blink');
            topoFolha.innerText = achado.display;
            topoFolha.style.color = achado.cor;
            topoFolha.style.borderBottomColor = achado.cor;
        } else {
            sidebarStatus.innerHTML = `<span>SCANNER</span><br><span class="radar-blink">BUSCANDO...</span>`;
            boxSidebar.style.borderColor = "var(--gold)";
            topoFolha.innerText = "CADERNO DE RESPOSTAS";
            topoFolha.style.color = "#64748b";
            topoFolha.style.borderBottomColor = "var(--line-color)";
        }
    };

    // --- AJUSTE NA TROCA DE EXAME PARA ACIONAR O RADAR ---
    window.abrirModalExames = () => {
        const content = document.getElementById('modal-content');
        content.innerHTML = `<h2 style="text-align:center; margin-bottom:15px;">EXAMES</h2>`;
        const grid = document.createElement('div'); grid.style.display="grid"; grid.style.gridTemplateColumns="1fr 1fr"; grid.style.gap="10px";
        for(let i=45; i>=35; i--) {
            const b = document.createElement('div'); b.className='opt-btn'; b.innerText=`Exame ${i}`;
            b.onclick = () => { 
                activeEx = i.toString(); 
                localStorage.setItem('activeEx', activeEx); 
                montarFolha(); 
                identificarPecaElite(); // <--- O RADAR JÁ ATIVA AQUI!
                fecharModal(); 
            };
            grid.appendChild(b);
        }
        content.appendChild(grid);
        document.getElementById('universal-modal').style.display='flex';
    };
