<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA JOAQUIM V4.5 - EST√ÅVEL</title>
    <style>
        :root { 
            --primary: #0f172a; --accent: #3b82f6; --bg: #f1f5f9; 
            --sidebar-bg: #1e293b; --law-green: #059669; --tst-blue: #2563eb; 
            --cf-purple: #9333ea; --paper: #ffffff;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: #1e293b; }
        header { background: var(--primary); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--accent); }
        .timer-box { background: #334155; padding: 5px 15px; border-radius: 20px; font-family: monospace; font-size: 1.1rem; color: #fbbf24; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        #main-app { display: none; }
        
        .main-layout { display: flex; flex-direction: column; min-height: 100vh; }
        @media (min-width: 768px) { .main-layout { flex-direction: row; } .sidebar { width: 260px; height: 100vh; position: sticky; top: 50px; } }
        
        .sidebar { background: var(--sidebar-bg); color: white; padding: 15px; overflow-y: auto; }
        .nav-btn { width: 100%; text-align: left; padding: 12px; margin-bottom: 6px; border: none; background: rgba(255,255,255,0.05); color: #cbd5e1; cursor: pointer; border-radius: 8px; font-size: 0.75rem; transition: 0.3s; }
        .nav-btn.active { background: var(--accent); color: white; font-weight: bold; border-left: 4px solid #fff; }

        .content-area { padding: 20px; flex-grow: 1; max-width: 1000px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        #joaquim { background: var(--paper); padding: 40px; border-radius: 4px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); min-height: 80vh; border: 1px solid #e2e8f0; }
        
        .gabarito-panel { background: #f8fafc; border: 1px solid #cbd5e1; padding: 15px; border-radius: 12px; margin-bottom: 25px; }
        .gab-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .gab-btn { background: #64748b; color: white; border: none; padding: 10px; border-radius: 6px; font-weight: bold; font-size: 0.75rem; cursor: pointer; }
        .guia-btn { width: 100%; background: var(--law-green); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 10px; text-transform: uppercase; }
        
        /* FORMATA√á√ÉO PALAVRA A PALAVRA */
        .gab-content, #texto-final { 
            margin-top: 20px; padding: 30px; background: #fff; border: 1px solid #e2e8f0; 
            border-radius: 4px; font-family: 'Times New Roman', serif; font-size: 1.25rem; 
            line-height: 1.8; color: #000; text-align: justify; white-space: pre-wrap; 
        }
        .paragrafo-juridico { text-indent: 3em; margin-bottom: 0.8em; display: block; }
        .titulo-juridico { font-weight: bold; text-align: center; margin: 1.5em 0 1em 0; text-transform: uppercase; display: block; }

        .guia-content { display: none; margin-top: 15px; padding: 20px; background: #f0fdf4; border-radius: 8px; border-left: 5px solid var(--law-green); max-height: 400px; overflow-y: auto; }
        .planalto-tools { margin-top: 15px; padding: 12px; background: #fff; border-radius: 8px; border: 1px dashed #cbd5e1; display: flex; flex-wrap: wrap; gap: 5px; }
        .btn-planalto { color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 0.7rem; font-weight: 600; }
        
        #texto-final { outline: none; min-height: 600px; border-top: 4px solid var(--accent); }
        .copy-btn { width: 100%; margin-bottom: 20px; background: var(--accent); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="login-screen">
    <button onclick="liberar()" style="padding:20px 50px; cursor:pointer; font-weight:bold; border-radius:50px; border:none; background:var(--accent); color:white; font-size: 1.3rem;">ACESSAR SIMULADOS</button>
</div>

<div id="main-app">
    <header>
        <div>JOAQUIM <span style="font-weight:200; opacity:0.7;">| SISTEMA DE MENTORIA</span></div>
        <div class="timer-box" id="cronometro">00:00:00</div>
    </header>
    <div class="main-layout">
        <nav class="sidebar" id="menuLateral"></nav>
        <main class="content-area">
            <div id="joaquim"></div>
        </main>
    </div>
</div>

<script src="gabaritos.js"></script>

<script>
    const nomesPecas = { 
        rt: "01. Reclama√ß√£o Trabalhista", cont: "04. Contesta√ß√£o", ro: "07. Recurso Ordin√°rio",
        ap: "15. Agravo de Peti√ß√£o", ms: "17. Mandado de Seguran√ßa" 
    };
    
    let pecaAtiva = 'ro';
    let segundos = 0;

    function liberar() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        montarMenu();
        loadPeca('ro');
        setInterval(() => { segundos++; atualizarCronometro(); }, 1000);
    }

    function atualizarCronometro() {
        const h = Math.floor(segundos / 3600).toString().padStart(2, '0');
        const m = Math.floor((segundos % 3600) / 60).toString().padStart(2, '0');
        const s = (segundos % 60).toString().padStart(2, '0');
        document.getElementById('cronometro').innerText = `${h}:${m}:${s}`;
    }

    function montarMenu() {
        const menu = document.getElementById('menuLateral');
        menu.innerHTML = Object.keys(nomesPecas).map(k => 
            `<button class="nav-btn ${k === pecaAtiva ? 'active' : ''}" id="btn_${k}" onclick="loadPeca('${k}')">${nomesPecas[k]}</button>`
        ).join('');
    }

    // MOTOR DE FORMATA√á√ÉO PALAVRA A PALAVRA
    function formatarTextoOAB(texto) {
        if(!texto) return "Texto n√£o encontrado no gabaritos.js";
        return texto.split('\n').map(linha => {
            const l = linha.trim();
            if (l === "") return '<br>';
            // Identifica se √© t√≠tulo (curto, sem ponto final, ou caixa alta)
            if ((l.length < 60 && !l.includes('.')) || l === l.toUpperCase() && l.length > 3) {
                return `<span class="titulo-juridico">${l}</span>`;
            }
            return `<div class="paragrafo-juridico">${l}</div>`;
        }).join('');
    }

    function loadPeca(key) {
        pecaAtiva = key;
        const db = (window.dbGabaritosExternos && window.dbGabaritosExternos[key]) ? window.dbGabaritosExternos[key] : {};
        
        let botoesGab = '';
        Object.keys(db).forEach(n => {
            if(!isNaN(n)) botoesGab += `<button class="gab-btn" onclick="toggleVis('gab_${n}')">üìñ Ver Gabarito ${n}</button>`;
        });

        document.getElementById('joaquim').innerHTML = `
            <button class="copy-btn" onclick="copyText()">COPIAR MINHA PE√áA</button>
            <div class="gabarito-panel">
                <div class="
