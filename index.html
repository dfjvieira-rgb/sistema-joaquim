<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA JOAQUIM - DESKTOP SIMULATOR</title>
    <style>
        :root { 
            --primary: #1a252f; --accent: #3498db; --bg: #f0f2f5; 
            --green: #27ae60; --red: #e74c3c; --header-h: 50px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; 
        }

        /* HEADER */
        header { 
            background: var(--primary); color: white; height: var(--header-h); 
            padding: 0 20px; display: flex; justify-content: space-between; align-items: center; 
            z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .header-btns { display: flex; gap: 10px; }
        .btn { border: none; padding: 6px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 0.75rem; transition: 0.3s; }
        .btn-save { background: var(--green); color: white; }
        .btn-clear { background: var(--red); color: white; }

        /* LAYOUT TRIPARTIDO */
        main { display: flex; flex: 1; overflow: hidden; gap: 5px; padding: 5px; }

        /* COLUNAS LATERAIS (PDFS) */
        .pdf-side { width: 30%; background: #525659; display: flex; flex-direction: column; border-radius: 4px; overflow: hidden; }
        .pdf-header { background: #333; color: white; padding: 5px 10px; font-size: 0.7rem; font-weight: bold; display: flex; justify-content: space-between; }
        .pdf-side iframe { flex: 1; border: none; background: white; }

        /* EDITOR CENTRAL (CADERNO DE PROVA) */
        .editor-container { 
            flex: 1; background: white; border-radius: 4px; display: flex; flex-direction: column; 
            box-shadow: 0 0 15px rgba(0,0,0,0.1); position: relative;
        }
        .editor-header { border-bottom: 1px solid #ddd; padding: 10px; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        
        .paper-area { flex: 1; display: flex; overflow-y: auto; background: #fff; position: relative; }
        
        /* LINHAS LATERAIS DA OAB */
        .line-numbers { 
            width: 35px; background: #f8f9fa; border-right: 1px solid #ddd; 
            padding-top: 30px; text-align: center; color: #999; font-family: monospace; font-size: 13px; line-height: 25px; user-select: none;
        }

        #area-peca { 
            flex: 1; padding: 30px 20px; border: none; outline: none; resize: none;
            font-family: 'Times New Roman', serif; font-size: 17px; line-height: 25px;
            background-image: linear-gradient(#eee 1px, transparent 1px);
            background-size: 100% 25px; background-attachment: local;
            color: #2c3e50;
        }

        /* BARRA DE STATUS INFERIOR */
        .status-bar { background: #fff; border-top: 1px solid #ddd; padding: 5px 15px; font-size: 0.7rem; display: flex; justify-content: space-between; color: #666; }

        /* SELETOR DE EXAME FLUTUANTE */
        #selector-overlay {
            position: fixed; top: var(--header-h); left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center;
        }
        .selector-modal { background: white; padding: 25px; border-radius: 8px; width: 400px; max-height: 80vh; overflow-y: auto; }
        .exame-opt { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; font-weight: bold; }
        .exame-opt:hover { background: var(--bg); color: var(--accent); }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:20px;">
        <span style="font-weight:bold; letter-spacing:1px;">SISTEMA JOAQUIM 2026</span>
        <div id="timer" style="color:#f1c40f; font-family:monospace; font-size:1.1rem;">05:00:00</div>
    </div>
    <div class="header-btns">
        <button class="btn" style="background:#34495e; color:white;" onclick="openSelector()">üîÑ TROCAR EXAME</button>
        <button class="btn btn-save" onclick="salvarLocal()">üíæ SALVAR RASCUNHO</button>
        <button class="btn" style="background:var(--accent); color:white;" onclick="exportarTXT()">üì• BAIXAR .TXT</button>
        <button class="btn btn-clear" onclick="limparTela()">üóëÔ∏è LIMPAR</button>
    </div>
</header>

<main>
    <aside class="pdf-side">
        <div class="pdf-header"><span>üìÑ ENUNCIADO (PROBLEMA)</span></div>
        <iframe id="v-enu" src="about:blank"></iframe>
    </aside>

    <section class="editor-container">
        <div class="editor-header">
            <span id="label-exame" style="font-weight:bold; color:var(--accent); font-size:0.8rem;">üìç SELECIONE UM EXAME</span>
            <span id="save-status" style="font-size:0.65rem; color:var(--green); font-weight:bold;"></span>
        </div>
        <div class="paper-area">
            <div class="line-numbers" id="line-nums"></div>
            <textarea id="area-peca" oninput="sincronizar()" spellcheck="false" placeholder="Inicie sua reda√ß√£o aqui..."></textarea>
        </div>
        <div class="status-bar">
            <span id="char-count">Caracteres: 0</span>
            <span id="line-count">Linha Atual: 1 / 150</span>
        </div>
    </section>

    <aside class="pdf-side">
        <div class="pdf-header"><span>‚öñÔ∏è PADR√ÉO DE RESPOSTA (FGV)</span></div>
        <iframe id="v-gab" src="about:blank"></iframe>
    </aside>
</main>

<div id="selector-overlay">
    <div class="selector-modal">
        <h3 style="margin-bottom:15px; border-bottom:2px solid var(--accent);">Escolha o Exame para Treinar:</h3>
        <div id="lista-exames"></div>
    </div>
</div>

<script>
    // Gerar n√∫meros de linha (1 a 150)
    const lineNums = document.getElementById('line-nums');
    for (let i = 1; i <= 150; i++) {
        lineNums.innerHTML += i + '<br>';
    }

    function openSelector() { document.getElementById('selector-overlay').style.display = 'flex'; }

    function montarLista() {
        const container = document.getElementById('lista-exames');
        for (let i = 35; i <= 45; i++) {
            container.innerHTML += `<div class="exame-opt" onclick="carregarExame('${i}')">OAB EXAME XXX${i}</div>`;
        }
    }

    function carregarExame(num) {
        const ts = new Date().getTime();
        document.getElementById('v-enu').src = `./ro${num}.pdf?v=${ts}`;
        document.getElementById('v-gab').src = `./ro${num}-gabarito.pdf?v=${ts}`;
        document.getElementById('label-exame').innerText = `üìç EXAME XXX${num} - CADERNO DE PROVA`;
        document.getElementById('selector-overlay').style.display = 'none';
        
        // Tentar carregar rascunho salvo deste exame espec√≠fico
        const salvo = localStorage.getItem('rascunho_oab_' + num);
        if(salvo) {
            if(confirm("Encontramos um rascunho salvo para este exame. Deseja carregar?")) {
                document.getElementById('area-peca').value = salvo;
                sincronizar();
            }
        }
    }

    function sincronizar() {
        const text = document.getElementById('area-peca').value;
        const lines = text.split('\n').length;
        document.getElementById('char-count').innerText = `Caracteres: ${text.length}`;
        document.getElementById('line-count').innerText = `Linha Atual: ${lines} / 150`;
        
        if(lines > 150) document.getElementById('line-count').style.color = 'var(--red)';
        else document.getElementById('line-count').style.color = '#666';
    }

    function salvarLocal() {
        const num = document.getElementById('label-exame').innerText.match(/\d+/);
        if(!num) { alert("Selecione um exame antes de salvar."); return; }
        
        const text = document.getElementById('area-peca').value;
        localStorage.setItem('rascunho_oab_' + num[0], text);
        
        const status = document.getElementById('save-status');
        status.innerText = "‚úì RASCUNHO SALVO NO NAVEGADOR";
        setTimeout(() => status.innerText = "", 3000);
    }

    function limparTela() {
        if(confirm("Isso apagar√° todo o texto atual. Confirmar?")) {
            document.getElementById('area-peca').value = '';
            sincronizar();
        }
    }

    function exportarTXT() {
        const text = document.getElementById('area-peca').value;
        const blob = new Blob([text], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `Peca_OAB_Exame.txt`;
        a.click();
    }

    // Timer
    let seconds = 18000;
    setInterval(() => {
        if (seconds <= 0) return;
        seconds--;
        let h = Math.floor(seconds / 3600);
        let m = Math.floor((seconds % 3600) / 60);
        let s = seconds % 60;
        document.getElementById('timer').innerText = 
            `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }, 1000);

    window.onload = montarLista;
</script>
</body>
</html>
