<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SISTEMA FGV - COMPLETO DISCURSIVAS</title>
    <style>
        :root {
            --fgv-bg: #f3f4f6; --paper-white: #ffffff; --fgv-blue: #004a8d;
            --line-height: 25px; --danger: #dc2626; --success: #16a34a; --gold: #c5a059;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: "Times New Roman", Times, serif; background: var(--fgv-bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        header { background: #fff; padding: 8px 15px; border-bottom: 3px solid var(--gold); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .header-left, .header-right { display: flex; align-items: center; gap: 6px; }
        
        #timer-display { font-family: monospace; font-size: 1.2rem; font-weight: bold; color: var(--danger); background: #fee2e2; padding: 4px 8px; border-radius: 4px; border: 1px solid var(--danger); }
        
        .btn-head { padding: 8px 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.7rem; color: white; text-transform: uppercase; }
        .bg-treinos { background: #4b5563; }
        .bg-postit { background: #eab308; color: #000; }
        .bg-dicas { background: #8b5cf6; }
        .bg-questoes { background: #2563eb; }
        .bg-timer { background: var(--success); }

        .nav-fgv { background: #e5e7eb; border-bottom: 1px solid #999; display: flex; overflow-x: auto; padding: 5px; gap: 5px; flex-shrink: 0; }
        .btn-nav { padding: 6px 12px; border: 1px solid #666; background: #fff; cursor: pointer; font-weight: bold; font-size: 0.65rem; white-space: nowrap; }

        .workspace { flex: 1; display: flex; gap: 4px; padding: 4px; background: #999; overflow: hidden; }
        .col-main { flex: 0 0 45%; display: flex; flex-direction: column; background: #fff; border-right: 2px solid #000; }
        .col-pdf { flex: 1; display: flex; flex-direction: column; background: #525659; }

        .sheet-top { background: #eee; border-bottom: 1px solid #000; padding: 6px; text-align: center; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .paper { flex: 1; display: flex; overflow-y: auto; background: var(--paper-white); position: relative; }
        .line-numbers { width: 35px; border-right: 1px solid #000; text-align: center; font-size: 11px; line-height: var(--line-height); padding-top: 5px; flex-shrink: 0; background: #f9f9f9; color: #000; }
        .textarea-fgv { flex: 1; border: none; outline: none; resize: none; padding: 0 10px; font-size: 18px; line-height: var(--line-height); background-image: linear-gradient(#ccc 1px, transparent 1px); background-size: 100% var(--line-height); background-attachment: local; }

        .modal-folha { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 5000; display: none; padding: 15px; }
        .modal-content { background: white; width: 100%; max-width: 850px; height: 95vh; margin: auto; display: flex; flex-direction: column; border: 4px solid #000; }
        .modal-controls { padding: 10px; background: #ddd; border-bottom: 1px solid #000; display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        
        .lista-itens { height: 90px; overflow-y: auto; background: #fff; border: 1px solid #999; font-size: 0.75rem; }
        .item-row { padding: 6px 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; cursor: pointer; }

        @media (max-width: 768px) {
            .workspace { flex-direction: column; overflow-y: auto; }
            .col-main, .col-pdf { flex: 0 0 auto; width: 100%; height: 80vh; }
            .header-left, .header-right { gap: 4px; }
            .btn-head { padding: 6px 5px; font-size: 0.6rem; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <div id="timer-display">05:00:00</div>
        <button id="timer-btn" class="btn-head bg-timer" onclick="toggleTimer()">INICIAR</button>
        <button class="btn-head bg-treinos" onclick="abrirBancoTreinos()">üìÇ TREINOS</button>
    </div>
    
    <div class="header-right">
        <button class="btn-head bg-postit" onclick="abrirFolhaEspecial('postits')">üìå POST-ITS</button>
        <button class="btn-head bg-dicas" onclick="abrirFolhaEspecial('dicas')">üìù DICAS</button>
        <button class="btn-head bg-questoes" onclick="abrirFolhaEspecial('questoes')">‚úçÔ∏è QUEST√ïES</button>
    </div>
</header>

<nav class="nav-fgv" id="exam-nav"></nav>

<main class="workspace">
    <section class="col-main">
        <div class="sheet-top">Folha de Resposta: PE√áA PROFISSIONAL</div>
        <div class="paper">
            <div class="line-numbers" id="nums-def"></div>
            <textarea id="txt-def" class="textarea-fgv" oninput="saveAuto()"></textarea>
        </div>
        <button class="bg-timer" style="padding:15px; border:none; color:white; font-weight:bold; cursor:pointer;" onclick="salvarNovoItemBanco()">üíæ SALVAR PE√áA ATUAL</button>
    </section>

    <section class="col-pdf">
        <div style="display:flex; background:#000;">
            <button class="btn-nav" style="flex:1; background:#333; color:white; border:none;" onclick="pdf('prova')">ENUNCIADO</button>
            <button class="btn-nav" style="flex:1; background:#333; color:white; border:none;" onclick="pdf('gabarito')">GABARITO</button>
        </div>
        <iframe id="frame" style="width:100%; height:100%; background:white; border:none;"></iframe>
    </section>
</main>

<div id="modal-folha" class="modal-folha">
    <div class="modal-content">
        <div class="sheet-top" id="modal-titulo">FOLHA FGV</div>
        <div class="modal-controls">
            <button onclick="novoItemModal()">[+] NOVO</button>
            <input type="text" id="modal-item-nome" placeholder="T√≠tulo (ex: Quest√£o 1 ou Tese X)..." style="flex:1; padding:6px;">
            <button onclick="salvarItemModal()" class="bg-timer" style="color:white; border:none; padding:6px 15px;">GRAVAR</button>
            <button onclick="fecharFolha()" style="background:red; color:white; border:none; padding:6px;">FECHAR</button>
        </div>
        
        <div id="modal-lista" class="lista-itens"></div>

        <div class="paper">
            <div class="line-numbers" id="nums-modal"></div>
            <textarea id="txt-modal" class="textarea-fgv" placeholder="Inicie sua resolu√ß√£o seguindo as linhas..."></textarea>
        </div>
        <button id="btn-transferir" onclick="transferirParaPeca()" class="bg-treinos" style="padding:12px; color:white; border:none; font-weight:bold; cursor:pointer;">TRANSFERIR PARA A PE√áA ‚Üë</button>
    </div>
</div>

<div id="modal-banco" class="modal-folha">
    <div class="modal-content" style="height:70vh; max-width:500px;">
        <div class="sheet-top">BANCO DE PE√áAS SALVAS</div>
        <div id="lista-banco-treinos" style="flex:1; overflow-y:auto; padding:15px;"></div>
        <button onclick="document.getElementById('modal-banco').style.display='none'" style="padding:15px; background:#000; color:#fff; border:none;">VOLTAR</button>
    </div>
</div>

<script>
    let ex = 42, dbAtual = '', idEditando = null, timeLeft = 18000, timerInterval = null;

    window.onload = () => {
        const nDef = document.getElementById('nums-def'), nMod = document.getElementById('nums-modal');
        for(let i=1; i<=150; i++) { 
            nDef.innerHTML += i + '<br>'; 
            nMod.innerHTML += i + '<br>'; 
        }
        document.getElementById('txt-def').value = localStorage.getItem('save_2026_peca') || "";
        
        const en = document.getElementById('exam-nav');
        for(let i=35; i<=44; i++) {
            let b = document.createElement('button'); b.className = 'btn-nav'; b.innerText = "EXAME "+i;
            b.onclick = () => { ex=i; pdf('prova'); }; en.appendChild(b);
        }
        pdf('prova');
    };

    // --- LOGICA DAS FOLHAS ESPECIAIS ---
    function abrirFolhaEspecial(tipo) {
        dbAtual = tipo; idEditando = null;
        const titulos = {
            'postits': 'üìå FOLHA DE POST-ITS (TESES)',
            'dicas': 'üìù FOLHA DE DICAS (CORRE√á√ïES)',
            'questoes': '‚úçÔ∏è FOLHA DE QUEST√ïES DISCURSIVAS'
        };
        const cores = { 'postits': '#eab308', 'dicas': '#8b5cf6', 'questoes': '#2563eb' };
        
        document.getElementById('modal-titulo').innerText = titulos[tipo];
        document.getElementById('modal-titulo').style.background = cores[tipo];
        document.getElementById('modal-titulo').style.color = tipo === 'postits' ? '#000' : '#fff';
        
        // Esconde transfer
