<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ARYANNA 2026 | MENTORIA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; background: #f1f5f9; padding: 15px; }
        .panel { background: #fff; border-radius: 12px; border: 2px solid #94a3b8; margin-bottom: 20px; overflow: hidden; }
        .panel-header { background: #f8fafc; padding: 10px; font-weight: bold; border-bottom: 2px solid #94a3b8; text-align: center; }
        .panel-body { padding: 15px; }
        .card-cofre { border-left: 8px solid #fbbf24; background: #fff; border: 1px solid #ddd; border-left-width: 8px; padding: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-revisar { background: #1d4ed8; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<header style="display:flex; justify-content:space-between; margin-bottom:20px;">
    <button onclick="window.close()" style="font-weight:bold; cursor:pointer;">FECHAR</button>
    <b style="font-size:1.2rem;">ARYANNA 2026</b>
</header>

<div class="panel">
    <div class="panel-header">PEÇAS NO COFRE</div>
    <div class="panel-body" id="feed-historico">
        <p style="text-align:center; color:gray;">Carregando cofre...</p>
    </div>
</div>

<div class="panel">
    <div class="panel-header">Preliminares</div>
    <div class="panel-body" id="feed-pre"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = { 
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", 
        authDomain: "masteroab-db5e1.firebaseapp.com", 
        projectId: "masteroab-db5e1", 
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" 
    };

    const app = initializeApp(config);
    const db = getDatabase(app);

    // --- LER PEÇAS DO COFRE ---
    onValue(ref(db, 'mentoria/historico'), (snapshot) => {
        const container = document.getElementById('feed-historico');
        container.innerHTML = "";
        const dados = snapshot.val();

        if (dados) {
            // Transformar em array e inverter para mostrar o mais novo primeiro
            Object.keys(dados).reverse().forEach(id => {
                const item = dados[id];
                container.innerHTML += `
                    <div class="card-cofre">
                        <div>
                            <small>EXAME OAB</small><br>
                            <b>EXAME ${item.exame}</b><br>
                            <small>${item.data}</small>
                        </div>
                        <button class="btn-revisar" onclick="revisarNoCockpit('${item.exame}')">REVISAR</button>
                    </div>
                `;
            });
        } else {
            container.innerHTML = "O cofre está vazio.";
        }
    });

    // --- LER PRELIMINARES ---
    onValue(ref(db, 'v13_pre'), (snapshot) => {
        const feed = document.getElementById('feed-pre');
        feed.innerHTML = "";
        const items = snapshot.val();
        if(items) {
            Object.keys(items).reverse().forEach(id => {
                feed.innerHTML += `<div style="border-bottom:1px solid #ddd; padding:10px;"><b>${items[id].t}</b><br><small>${items[id].c}</small></div>`;
            });
        }
    });

    window.revisarNoCockpit = (ex) => {
        if(window.opener) {
            window.opener.localStorage.setItem('activeEx', ex);
            window.opener.location.reload();
            window.close();
        } else {
            alert("Abra pelo Cockpit!");
        }
    };
</script>
</body>
</html>
