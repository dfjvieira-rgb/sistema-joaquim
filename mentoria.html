<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>SISTEMA ARYANNA 2026 | INTELIG√äNCIA JUR√çDICA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --bg: #f1f5f9; --text: #1e293b; --card: #ffffff;
            --primary: #3b82f6; --warning: #fbbf24; --danger: #ef4444;
            --success: #10b981; --purple: #8b5cf6; --border: #e2e8f0;
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #0f172a; --text: #cbd5e1; --card: #1e293b; --border: #334155; }
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 10px; }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--card); border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border); }
        h1 { font-size: 0.9rem; font-weight: 800; color: var(--primary); text-transform: uppercase; }

        /* GRID RESPONSIVO */
        .main-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        
        .panel { background: var(--card); border-radius: 16px; padding: 20px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); align-self: start; }
        .panel-title { font-size: 0.75rem; font-weight: 900; text-transform: uppercase; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }

        /* CAMPOS */
        .mentoria-box { margin-bottom: 12px; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.02); border-left: 4px solid var(--primary); position: relative; }
        .mentoria-box.purple { border-left-color: var(--purple); background: rgba(139, 92, 246, 0.03); }
        .mentoria-box.nc { border-left-color: var(--danger); }
        .mentoria-box.do { border-left-color: var(--warning); }
        
        label { font-size: 0.6rem; font-weight: 800; display: block; margin-bottom: 5px; opacity: 0.7; }
        input, textarea { width: 100%; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: 8px; font-size: 0.85rem; outline: none; }
        textarea { font-family: 'Courier Prime', monospace; resize: none; }

        /* BOT√ïES */
        .btn { width: 100%; border: none; padding: 14px; border-radius: 10px; font-weight: 800; cursor: pointer; font-size: 0.75rem; text-transform: uppercase; transition: 0.3s; margin-top: 5px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-purple { background: var(--purple); color: white; }
        .btn-ghost { background: none; border: 1px dashed var(--danger); color: var(--danger); margin-top: 10px; }

        /* FEED */
        .feed { margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border); max-height: 500px; overflow-y: auto; }
        .card { position: relative; background: var(--bg); padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid var(--border); }
        .btn-del { position: absolute; top: 10px; right: 10px; color: var(--danger); border: none; background: none; cursor: pointer; opacity: 0.5; }
        .btn-del:hover { opacity: 1; }
        
        .tag-peca { background: var(--purple); color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.6rem; font-weight: 900; margin-bottom: 8px; display: inline-block; }
        
        @media (max-width: 600px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-brain"></i> Mentoria Sincronizada</h1>
    <div style="font-size: 0.6rem; font-weight: 800; color: var(--success);"><i class="fas fa-circle"></i> SERVER LIVE</div>
</header>

<div class="main-grid">
    
    <div class="panel">
        <div class="panel-title" style="color: var(--purple);"><i class="fas fa-puzzle-piece"></i> Qual √© a Pe√ßa?</div>
        
        <div class="mentoria-box purple">
            <label>Hist√≥ria / Enunciado do Exame</label>
            <textarea id="peca-historia" style="min-height: 120px;" placeholder="Cole aqui o trecho final do problema..."></textarea>
        </div>

        <div class="mentoria-box purple">
            <label>Pe√ßa Cab√≠vel & Gatilhos T√©cnicos</label>
            <input type="text" id="peca-resposta" placeholder="Ex: Recurso Ordin√°rio - Art. 895, I, CLT">
            <textarea id="peca-porqu√™" style="margin-top:8px; min-height: 60px;" placeholder="Por que √© esta pe√ßa? Ex: Houve senten√ßa terminativa..."></textarea>
        </div>

        <button class="btn btn-purple" onclick="salvarQualAPeca()">Sincronizar Desafio</button>

        <div class="feed" id="feed-pecas"></div>
    </div>

    <div class="panel">
        <div class="panel-title" style="color: var(--warning);"><i class="fas fa-chess-knight"></i> Radar de Estrat√©gia</div>
        
        <div class="mentoria-box do">
            <label>üí° Dica de Ouro (Post-it)</label>
            <textarea id="dica-ouro" placeholder="Pegadinhas frequentes ou lembretes..."></textarea>
        </div>

        <div id="wrapper-nc">
            <div class="mentoria-box nc">
                <label>üìå N√£o Confunda</label>
                <textarea class="nc-input" placeholder="Diferen√ßa A vs B..."></textarea>
            </div>
        </div>

        <button class="btn btn-ghost" onclick="addNC()">+ Adicionar Diferencia√ß√£o</button>
        <button class="btn" style="background: #1e293b; color: #fbbf24;" onclick="salvarRadar()">Salvar Estrat√©gia</button>

        <div class="feed" id="feed-radar"></div>
    </div>

    <div class="panel">
        <div class="panel-title" style="color: var(--primary);"><i class="fas fa-gavel"></i> Dicion√°rio de Teses</div>
        
        <input type="text" id="tese-tit" placeholder="T√≠tulo da Tese" style="margin-bottom:10px;">
        
        <div class="mentoria-box" style="border-left-color:#94a3b8;"><label>FATO</label><textarea id="tese-fato"></textarea></div>
        <div class="mentoria-box" style="border-left-color:#3b82f6;"><label>FUNDAMENTO</label><textarea id="tese-fund"></textarea></div>
        <div class="mentoria-box" style="border-left-color:#10b981;"><label>PEDIDO</label><textarea id="tese-ped"></textarea></div>

        <button class="btn btn-primary" onclick="salvarTese()">Arquivar Tese</button>

        <div class="feed" id="feed-teses"></div>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = { 
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", 
        authDomain: "masteroab-db5e1.firebaseapp.com", 
        projectId: "masteroab-db5e1", 
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" 
    };

    const app = initializeApp(config);
    const db = getDatabase(app);

    // FUN√á√ÉO QUAL √â A PE√áA
    window.salvarQualAPeca = () => {
        const hist = document.getElementById('peca-historia').value;
        const resp = document.getElementById('peca-resposta').value;
        const pq = document.getElementById('peca-porqu√™').value;
        if(!hist || !resp) return alert("Preencha a hist√≥ria e a pe√ßa!");

        push(ref(db, 'v10_qual_e_a_peca'), {
            historia: hist, resposta: resp, porqu√™: pq, timestamp: serverTimestamp()
        });
        document.getElementById('peca-historia').value = ''; 
        document.getElementById('peca-resposta').value = '';
        document.getElementById('peca-porqu√™').value = '';
    };

    // FUN√á√ïES RADAR
    window.addNC = () => {
        const div = document.createElement('div');
        div.className = 'mentoria-box nc';
        div.innerHTML = `<label>üìå N√£o Confunda</label><textarea class="nc-input"></textarea><button onclick="this.parentElement.remove()" style="position:absolute;top:5px;right:5px;border:none;background:none;color:red;">√ó</button>`;
        document.getElementById('wrapper-nc').appendChild(div);
    };

    window.salvarRadar = () => {
        const dica = document.getElementById('dica-ouro').value;
        const ncs = Array.from(document.querySelectorAll('.nc-input')).map(i => i.value).filter(v => v);
        push(ref(db, 'v10_radar_estrategia'), { dicaOuro: dica, naoConfunda: ncs, postIt: true, timestamp: serverTimestamp() });
        document.getElementById('dica-ouro').value = '';
    };

    // FUN√á√ÉO TESE
    window.salvarTese = () => {
        const t = document.getElementById('tese-tit').value;
        const f = document.getElementById('tese-fato').value;
        const fu = document.getElementById('tese-fund').value;
        const p = document.getElementById('tese-ped').value;
        push(ref(db, 'v10_teses_sincronizadas'), { titulo: t, fato: f, fundamento: fu, pedido: p, timestamp: serverTimestamp() });
        ['tese-tit','tese-fato','tese-fund','tese-ped'].forEach(id => document.getElementById(id).value = '');
    };

    window.excluir = (path, id) => { if(confirm("Apagar?")) remove(ref(db, `${path}/${id}`)); };

    // LISTENERS
    onValue(ref(db), (snap) => {
        const data = snap.val() || {};
        
        // Render Pe√ßas
        const fPecas = document.getElementById('feed-pecas');
        fPecas.innerHTML = "";
        const pObj = data.v10_qual_e_a_peca || {};
        Object.keys(pObj).reverse().forEach(id => {
            fPecas.innerHTML += `<div class="card">
                <button class="btn-del" onclick="excluir('v10_qual_e_a_peca','${id}')"><i class="fas fa-trash"></i></button>
                <div class="tag-peca">CASO PR√ÅTICO</div>
                <p style="font-size:0.75rem; font-style:italic; margin-bottom:10px;">"${pObj[id].historia}"</p>
                <div style="background:var(--purple); color:white; padding:10px; border-radius:8px;">
                    <small style="font-weight:900; display:block; font-size:0.6rem;">RESPOSTA:</small>
                    <strong style="font-size:0.85rem;">${pObj[id].resposta}</strong>
                    <p style="font-size:0.75rem; margin-top:5px; opacity:0.9;">${pObj[id].porqu√™}</p>
                </div>
            </div>`;
        });

        // Render Radar
        const fRadar = document.getElementById('feed-radar');
        fRadar.innerHTML = "";
        const rObj = data.v10_radar_estrategia || {};
        Object.keys(rObj).reverse().forEach(id => {
            const item = rObj[id];
            fRadar.innerHTML += `<div class="card" style="border-left:5px solid var(--warning)">
                <button class="btn-del" onclick="excluir('v10_radar_estrategia','${id}')"><i class="fas fa-trash"></i></button>
                ${item.dicaOuro ? `<strong style="color:var(--warning); font-size:0.75rem;">üí° DICA: ${item.dicaOuro}</strong>` : ''}
                ${(item.naoConfunda || []).map(nc => `<p style="font-size:0.8rem; margin-top:5px;">‚ùå ${nc}</p>`).join('')}
            </div>`;
        });

        // Render Teses
        const fTeses = document.getElementById('feed-teses');
        fTeses.innerHTML = "";
        const tObj = data.v10_teses_sincronizadas || {};
        Object.keys(tObj).reverse().forEach(id => {
            const item = tObj[id];
            fTeses.innerHTML += `<div class="card" style="border-left:5px solid var(--primary)">
                <button class="btn-del" onclick="excluir('v10_teses_sincronizadas','${id}')"><i class="fas fa-trash"></i></button>
                <strong style="font-size:0.85rem; color:var(--primary);">${item.titulo}</strong>
                <p style="font-size:0.75rem; margin-top:5px;"><strong>F:</strong> ${item.fato}</p>
            </div>`;
        });
    });
</script>
</body>
</html>
