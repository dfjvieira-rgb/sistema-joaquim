<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ FLUXO DE TESES | APROVADO OAB</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --gold: #d4af37; --success: #10b981; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 15px; padding-bottom: 120px; }
        
        header { text-align: center; padding-bottom: 10px; border-bottom: 2px solid var(--gold); margin-bottom: 15px; }
        h1 { color: var(--gold); font-size: 1rem; text-transform: uppercase; }

        .stats-bar { text-align: center; font-size: 0.75rem; margin-bottom: 15px; color: var(--success); font-weight: 800; }

        /* FORMUL√ÅRIO DE FLUXO */
        .form-flow { background: var(--card); border-radius: 12px; padding: 15px; border: 2px solid var(--primary); margin-bottom: 20px; box-shadow: 0 0 20px rgba(37, 99, 235, 0.2); }
        .form-flow input, .form-flow select, .form-flow textarea { 
            width: 100%; background: #0f172a; border: 1px solid #334155; 
            color: #fff; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-family: 'Inter'; font-size: 0.9rem;
        }
        .btn-next { 
            width: 100%; background: var(--success); color: #000; border: none; 
            padding: 18px; border-radius: 8px; font-weight: 900; cursor: pointer; 
            text-transform: uppercase; font-size: 0.9rem; transition: 0.3s;
        }
        .btn-next:active { transform: scale(0.98); background: var(--gold); }

        /* LISTA DE REVIS√ÉO */
        h2 { font-size: 0.8rem; color: var(--gold); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .tese-card { background: var(--card); border-radius: 12px; padding: 15px; border-left: 5px solid var(--success); animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .tag { font-size: 0.6rem; font-weight: 800; padding: 3px 8px; border-radius: 4px; display: inline-block; margin-bottom: 8px; color: #fff; }
        .tag-fato { background: #3b82f6; }
        .tag-fund { background: #8b5cf6; }
        .tag-pedi { background: #f59e0b; }

        .tese-card h3 { font-size: 0.9rem; margin-bottom: 5px; color: #fff; }
        .tese-card p { font-size: 0.8rem; color: #cbd5e1; line-height: 1.4; }

        .btn-back { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #fff; color: #000; border: 2px solid #000; padding: 18px 45px; 
            border-radius: 50px; font-weight: 800; text-decoration: none; 
            font-size: 1rem; box-shadow: 0 8px 30px rgba(0,0,0,0.5); z-index: 9999; width: 85%; text-align: center;
        }
    </style>
</head>
<body>

<header>
    <h1>üöÄ FLUXO DE TESES PERSONALIZADAS</h1>
</header>

<div class="stats-bar">
    ‚úÖ <span id="count">0</span> TESES CONCLU√çDAS NA SUA MENTORIA
</div>

<div class="form-flow">
    <input type="text" id="titulo" placeholder="Nome da Tese (Ex: Horas Extras)">
    <select id="categoria">
        <option value="fato">üîµ FATO</option>
        <option value="fund">üü£ FUNDAMENTO (Artigo/S√∫mula)</option>
        <option value="pedi">üü° PEDIDO</option>
    </select>
    <textarea id="conteudo" rows="3" placeholder="Escreva a tese aqui..."></textarea>
    <button class="btn-next" onclick="finalizarEProxima()">FINALIZAR E PR√ìXIMA ‚ûî</button>
</div>

<h2>üìã MINHA FOLHA DE REVIS√ÉO</h2>
<div class="grid" id="grid-teses"></div>

<a href="index.html" class="btn-back">‚¨Ö VOLTAR AO TREINO</a>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    
    const config = { 
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", 
        authDomain: "masteroab-db5e1.firebaseapp.com", 
        projectId: "masteroab-db5e1", 
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" 
    };
    
    const app = initializeApp(config);
    const db = getDatabase(app);
    const dbRef = ref(db, 'v7_fluxo_teses');

    window.finalizarEProxima = () => {
        const tit = document.getElementById('titulo').value;
        const cat = document.getElementById('categoria').value;
        const cont = document.getElementById('conteudo').value;

        if(tit && cont) {
            // Salva no Firebase
            push(dbRef, { titulo: tit, categoria: cat, conteudo: cont, data: new Date().toLocaleDateString() });
            
            // Limpa os campos para a pr√≥xima
            document.getElementById('titulo').value = '';
            document.getElementById('conteudo').value = '';
            document.getElementById('titulo').focus(); // Foca no t√≠tulo automaticamente
        } else {
            alert("Preencha os campos antes de prosseguir!");
        }
    };

    // Atualiza a grade e o contador
    onValue(dbRef, (snapshot) => {
        const grid = document.getElementById('grid-teses');
        const countSpan = document.getElementById('count');
        grid.innerHTML = "";
        
        if (snapshot.exists()) {
            const dados = snapshot.val();
            const keys = Object.keys(dados).reverse();
            countSpan.innerText = keys.length;

            keys.forEach(id => {
                const item = dados[id];
                const card = document.createElement('div');
                card.className = 'tese-card';
                card.innerHTML = `
                    <span class="tag tag-${item.categoria}">${item.categoria.toUpperCase()}</span>
                    <h3>${item.titulo}</h3>
                    <p>${item.conteudo}</p>
                `;
                grid.appendChild(card);
            });
        }
    });
</script>
</body>
</html>
