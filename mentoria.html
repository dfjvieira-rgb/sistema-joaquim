<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ARYANNA 2026 | MENTORIA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #f1f5f9; --text: #000; --primary: #1d4ed8; --border: #94a3b8; --purple: #5b21b6; --success: #065f46; --gold: #fbbf24; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 50px; }
        header { background: #fff; border-bottom: 2px solid var(--border); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .btn-acao { text-decoration: none; color: #000; font-weight: 800; border: 2px solid #000; padding: 8px 15px; border-radius: 8px; display: flex; align-items: center; gap: 8px; font-size: 0.8rem; cursor: pointer; background: white; }
        .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; }
        .panel { background: #fff; border-radius: 12px; border: 2px solid var(--border); margin-bottom: 15px; }
        .panel-header { padding: 12px; background: #f8fafc; border-bottom: 2px solid var(--border); font-size: 0.8rem; font-weight: 800; text-transform: uppercase; text-align: center; }
        .panel-body { padding: 15px; }
        .feed { margin-top: 10px; }
        .card { background: #fff; padding: 12px; border-radius: 8px; border: 2px solid var(--border); margin-bottom: 8px; }
        
        /* ESTILO DOS CARDS DO COFRE */
        .card-pdf { 
            border-left: 8px solid var(--gold); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .info-peca { display: flex; flex-direction: column; }
        .info-peca b { font-size: 1rem; color: #1e293b; }
        .info-peca span { font-size: 0.7rem; color: #64748b; font-weight: bold; }
        
        .btn-revisar { 
            background: var(--primary); color: white; border: none; 
            padding: 8px 12px; border-radius: 6px; font-weight: bold; 
            cursor: pointer; font-size: 0.7rem;
        }

        .modo-leitura .btn-save, .modo-leitura label, .modo-leitura input, .modo-leitura textarea { display: none !important; }
        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<header>
    <a id="btn-voltar" class="btn-acao"><i class="fas fa-sync-alt"></i></a>
    <div style="font-weight: 800;">ARYANNA 2026 | MENTORIA</div>
</header>

<main class="dashboard">
    <section id="section-historico" class="panel" style="grid-column: span 2; border-top: 6px solid var(--gold);">
        <div class="panel-header">PEÇAS NO COFRE</div>
        <div class="panel-body">
            <div id="feed-historico" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px;">
                </div>
        </div>
    </section>

    <section class="panel" style="border-top: 6px solid var(--success);">
        <div class="panel-header">Anotações / Preliminares</div>
        <div class="panel-body">
            <div id="feed-pre"></div>
        </div>
    </section>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    
    // Configuração do seu Banco
    const config = { 
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", 
        authDomain: "masteroab-db5e1.firebaseapp.com", 
        projectId: "masteroab-db5e1", 
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" 
    };
    
    const app = initializeApp(config);
    const db = getDatabase(app);

    // Ajuste do Botão Voltar/Fechar
    const isConsultor = new URLSearchParams(window.location.search).get('mode') === 'consultor';
    const btn = document.getElementById('btn-voltar');
    if(isConsultor) {
        document.body.classList.add('modo-leitura');
        btn.innerHTML = '<i class="fas fa-times"></i> FECHAR';
        btn.onclick = () => window.close();
    } else {
        btn.innerHTML = '<i class="fas fa-arrow-left"></i> VOLTAR';
        btn.onclick = () => window.location.href='index.html';
    }

    // --- LEITURA DO HISTÓRICO ---
    const historicoRef = ref(db, 'mentoria/historico');
    
    onValue(historicoRef, (snapshot) => {
        const container = document.getElementById('feed-historico');
        container.innerHTML = ""; // Limpa para atualizar
        
        const dados = snapshot.val();
        
        if (dados) {
            // Converte objeto em array e inverte para ver os mais recentes primeiro
            Object.keys(dados).reverse().forEach(id => {
                const item = dados[id];
                
                const card = document.createElement('div');
                card.className = 'card card-pdf';
                card.innerHTML = `
                    <div class="info-peca">
                        <span>EXAME OAB</span>
                        <b>EXAME ${item.exame}</b>
                        <span>Enviado em: ${item.data}</span>
                    </div>
                    <button class="btn-revisar" onclick="revisarExame('${item.exame}')">REVISAR</button>
                `;
                container.appendChild(card);
            });
        } else {
            container.innerHTML = "<p style='text-align:center; color:#94a3b8; font-size:0.8rem;'>Nenhum exame finalizado ainda.</p>";
        }
    });

    // Função para carregar o exame na janela principal
    window.revisarExame = (num) => {
        if(window.opener) {
            window.opener.localStorage.setItem('activeEx', num);
            window.opener.location.reload();
            window.close();
        } else {
            alert("Para revisar, abra o Robô através do Cockpit principal.");
        }
    };
</script>
</body>
</html>
